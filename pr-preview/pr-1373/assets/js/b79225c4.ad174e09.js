"use strict";(self.webpackChunkcontrast_docs=self.webpackChunkcontrast_docs||[]).push([[8269],{28453:(e,o,n)=>{n.d(o,{R:()=>i,x:()=>s});var t=n(96540);const r={},a=t.createContext(r);function i(e){const o=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function s(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(a.Provider,{value:o},e.children)}},80848:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"howto/coordinator-ha","title":"Coordinator High-Availability","description":"Coordinator HA is only available in the enterprise edition of Contrast.","source":"@site/docs/howto/coordinator-ha.md","sourceDirName":"howto","slug":"/howto/coordinator-ha","permalink":"/contrast/pr-preview/pr-1373/next/howto/coordinator-ha","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/contrast/edit/main/docs/docs/howto/coordinator-ha.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"AMD SEV-SNP attestation","permalink":"/contrast/pr-preview/pr-1373/next/architecture/snp"},"next":{"title":"Registry authentication","permalink":"/contrast/pr-preview/pr-1373/next/howto/registry-authentication"}}');var r=n(74848),a=n(28453);const i={},s="Coordinator High-Availability",d={},c=[{value:"Workflow",id:"workflow",level:2},{value:"How it works",id:"how-it-works",level:2}];function l(e){const o={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.header,{children:(0,r.jsx)(o.h1,{id:"coordinator-high-availability",children:"Coordinator High-Availability"})}),"\n",(0,r.jsx)(o.admonition,{type:"info",children:(0,r.jsx)(o.p,{children:"Coordinator HA is only available in the enterprise edition of Contrast."})}),"\n",(0,r.jsx)(o.p,{children:"This guide shows how to scale the Contrast Coordinator to more than one instance and make it highly available."}),"\n",(0,r.jsx)(o.h2,{id:"workflow",children:"Workflow"}),"\n",(0,r.jsxs)(o.p,{children:["Deploy the Coordinator according to the ",(0,r.jsx)(o.a,{href:"/contrast/pr-preview/pr-1373/next/deployment",children:"basic workflow"}),".\nBy default, there is only one Coordinator instance.\nVerify that this Coordinator is in state ",(0,r.jsx)(o.code,{children:"Ready"}),":"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-sh",children:"kubectl get pods -l app.kubernetes.io/name=coordinator\n"})}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-raw",children:"NAME            READY   STATUS    RESTARTS   AGE\ncoordinator-0   1/1     Running   0          7m36s\n"})}),"\n",(0,r.jsx)(o.p,{children:"Next, we increase the number of instances to 3:"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-sh",children:"kubectl scale statefulset/coordinator --replicas 3\n"})}),"\n",(0,r.jsxs)(o.p,{children:["This will create additional Coordinator instances, one after another, as described in the ",(0,r.jsxs)(o.a,{href:"https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#deployment-and-scaling-guarantees",children:["Kubernetes documentation for ",(0,r.jsx)(o.code,{children:"StatefulSet"})]}),".\nAfter some time, the additional Coordinators should enter the ",(0,r.jsx)(o.code,{children:"Ready"})," state, too."]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-sh",children:"kubectl get pods -l app.kubernetes.io/name=coordinator\n"})}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-raw",children:"NAME            READY   STATUS    RESTARTS   AGE\ncoordinator-0   1/1     Running   0          12m\ncoordinator-1   1/1     Running   0          2m51s\ncoordinator-2   1/1     Running   0          2m26s\n"})}),"\n",(0,r.jsx)(o.p,{children:"You can now try deleting individual Coordinator pods, draining a node in a multi-node cluster, or scheduling a full rollout of the Coordinator.\nAvailability of the Coordinator endpoint should not be affected, and all Coordinator pods should automatically recover."}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-sh",children:"kubectl rollout restart statefulset/coordinator\nsleep 2m\nkubectl get pods -l app.kubernetes.io/name=coordinator\n"})}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-raw",children:"statefulset.apps/coordinator restarted\nNAME            READY   STATUS    RESTARTS   AGE\ncoordinator-0   1/1     Running   0          80s\ncoordinator-1   1/1     Running   0          104s\ncoordinator-2   1/1     Running   0          2m\n"})}),"\n",(0,r.jsx)(o.h2,{id:"how-it-works",children:"How it works"}),"\n",(0,r.jsxs)(o.p,{children:["Newly started (or restarted) Coordinator instances try to recover from other Coordinator instances in the cluster.\nAs long as a single Coordinator is initialized, the other instances eventually recover from it.\n",(0,r.jsx)(o.code,{children:"StatefulSet"})," semantics guarantee that Coordinator pods are started predictably"]})]})}function h(e={}){const{wrapper:o}={...(0,a.R)(),...e.components};return o?(0,r.jsx)(o,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}}}]);