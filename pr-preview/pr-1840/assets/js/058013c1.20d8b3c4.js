"use strict";(globalThis.webpackChunkcontrast_docs=globalThis.webpackChunkcontrast_docs||[]).push([[9026],{28453:(e,t,r)=>{r.d(t,{R:()=>s,x:()=>a});var n=r(96540);const o={},i=n.createContext(o);function s(e){const t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),n.createElement(i.Provider,{value:t},e.children)}},83374:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"howto/immutable-deployments","title":"Immutable deployments with Contrast","description":"This section explains how to setup a Contrast deployment that can\'t be changed after the initial setup.","source":"@site/docs/howto/immutable-deployments.md","sourceDirName":"howto","slug":"/howto/immutable-deployments","permalink":"/contrast/pr-preview/pr-1840/next/howto/immutable-deployments","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/contrast/edit/main/docs/docs/howto/immutable-deployments.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Secure image store","permalink":"/contrast/pr-preview/pr-1840/next/howto/secure-image-store"},"next":{"title":"Troubleshooting","permalink":"/contrast/pr-preview/pr-1840/next/howto/troubleshooting"}}');var o=r(74848),i=r(28453);const s={},a="Immutable deployments with Contrast",l={},d=[{value:"Applicability",id:"applicability",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"How-To",id:"how-to",level:2},{value:"Preventing manifest updates",id:"preventing-manifest-updates",level:3},{value:"Preventing decryption of state and recovery",id:"preventing-decryption-of-state-and-recovery",level:3},{value:"Verifying immutability",id:"verifying-immutability",level:3}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"immutable-deployments-with-contrast",children:"Immutable deployments with Contrast"})}),"\n",(0,o.jsx)(t.p,{children:"This section explains how to setup a Contrast deployment that can't be changed after the initial setup."}),"\n",(0,o.jsx)(t.h2,{id:"applicability",children:"Applicability"}),"\n",(0,o.jsx)(t.p,{children:"In multi-party setups with (mutually) distrusting parties, ensuring that no party can alter the deployment or decrypt state can be desirable."}),"\n",(0,o.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"/contrast/pr-preview/pr-1840/next/howto/cluster-setup/bare-metal",children:"Set up cluster"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"/contrast/pr-preview/pr-1840/next/howto/install-cli",children:"Install CLI"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"/contrast/pr-preview/pr-1840/next/howto/workload-deployment/runtime-deployment",children:"Deploy the Contrast runtime"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"/contrast/pr-preview/pr-1840/next/howto/workload-deployment/add-coordinator",children:"Add Coordinator to resources"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"/contrast/pr-preview/pr-1840/next/howto/workload-deployment/deployment-file-preparation",children:"Prepare deployment files"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"/contrast/pr-preview/pr-1840/next/howto/workload-deployment/generate-annotations",children:"Generate annotations and manifest"})}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"how-to",children:"How-To"}),"\n",(0,o.jsxs)(t.p,{children:["After running the ",(0,o.jsx)(t.a,{href:"/contrast/pr-preview/pr-1840/next/howto/workload-deployment/generate-annotations",children:(0,o.jsx)(t.code,{children:"contrast generate"})})," command, the manifest contains fields ",(0,o.jsx)(t.code,{children:"WorkloadOwnerKeyDigest"})," and ",(0,o.jsx)(t.code,{children:"SeedshareOwnerPubKeys"}),".\nDeleting these fields before calling ",(0,o.jsx)(t.a,{href:"/contrast/pr-preview/pr-1840/next/howto/workload-deployment/set-manifest",children:(0,o.jsx)(t.code,{children:"contrast set"})})," for the first time will render the deployment immutable and make Coordinator recovery impossible."]}),"\n",(0,o.jsx)(t.h3,{id:"preventing-manifest-updates",children:"Preventing manifest updates"}),"\n",(0,o.jsxs)(t.p,{children:["To prevent manifest updates, delete the ",(0,o.jsx)(t.code,{children:"WorkloadOwnerKeyDigest"})," before calling ",(0,o.jsx)(t.code,{children:"contrast set"})," for the first time.\nWhile the ",(0,o.jsx)(t.code,{children:"WorkloadOwnerKeyDigest"})," can be removed at a later point, it should ideally never be ",(0,o.jsx)(t.code,{children:"set"})," for immutable deployments.\nAfter removal of the key, ",(0,o.jsx)(t.a,{href:"/contrast/pr-preview/pr-1840/next/howto/workload-deployment/set-manifest",children:"set the manifest"})," through ",(0,o.jsx)(t.code,{children:"contrast set"}),".\nOnce completed, the Contrast Coordinator will no longer accept the workload owner key for future manifest changes.\nThe seed share owner can still force manifest changes through the ",(0,o.jsx)(t.a,{href:"/contrast/pr-preview/pr-1840/next/howto/workload-deployment/recover-coordinator",children:"recovery mechanism"}),", if they're able to access to the Coordinator's ",(0,o.jsx)(t.code,{children:"ConfigMap"}),"s."]}),"\n",(0,o.jsxs)(t.p,{children:["Alternatively, specify the ",(0,o.jsx)(t.code,{children:"--disable-updates"})," flag in the ",(0,o.jsx)(t.code,{children:"generate"})," step for the same result."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:"contrast generate --reference-values <platform> --disable-updates resources/\n"})}),"\n",(0,o.jsx)(t.admonition,{type:"warning",children:(0,o.jsxs)(t.p,{children:["This action is irreversible.\nYou won't be able to make changes to your deployment after running ",(0,o.jsx)(t.code,{children:"contrast set"})," with an empty ",(0,o.jsx)(t.code,{children:"WorkloadOwnerKeyDigest"}),"."]})}),"\n",(0,o.jsx)(t.h3,{id:"preventing-decryption-of-state-and-recovery",children:"Preventing decryption of state and recovery"}),"\n",(0,o.jsxs)(t.p,{children:["Deleting the ",(0,o.jsx)(t.code,{children:"SeedshareOwnerPubKeys"})," field from the manifest before calling ",(0,o.jsx)(t.code,{children:"contrast set"})," for the first time will make it impossible to recover both the Contrast Coordinator and any state associated with a deployment.\nNote that deletion of the ",(0,o.jsx)(t.code,{children:"SeedshareOwnerPubKeys"})," needs to occur before the first use of ",(0,o.jsx)(t.code,{children:"contrast set"}),", since setting the manifest will fail if this key has been changed.\nNormally, the Coordinator ",(0,o.jsx)(t.a,{href:"/contrast/pr-preview/pr-1840/next/howto/workload-deployment/recover-coordinator",children:"can be recovered after a restart"}),".\nWith an empty list of ",(0,o.jsx)(t.code,{children:"SeedshareOwnerPubKeys"}),", this becomes impossible because no keys will be accepted.\nThis also preempts ",(0,o.jsx)(t.a,{href:"/contrast/pr-preview/pr-1840/next/architecture/secrets#workload-secrets",children:"workload secret recovery"}),", and thus makes it impossible to re-open ",(0,o.jsx)(t.a,{href:"/contrast/pr-preview/pr-1840/next/howto/encrypted-storage",children:"encrypted persistent storage"})," after a Coordinator restart."]}),"\n",(0,o.jsxs)(t.admonition,{type:"warning",children:[(0,o.jsxs)(t.p,{children:["This action is irreversible.\nYou won't be able to recover the Contrast Coordinator after a restart.\nFurther, any associated state will also be irrecoverable.\nRemoving the ",(0,o.jsx)(t.code,{children:"SeedshareOwnerPubKeys"})," effectively turns a (persistent) deployment into an ephemeral one."]}),(0,o.jsx)(t.p,{children:(0,o.jsx)(t.strong,{children:"It's highly unlikely that you want to use this feature in conjunction with the encrypted persistent storage feature."})})]}),"\n",(0,o.jsx)(t.h3,{id:"verifying-immutability",children:"Verifying immutability"}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.a,{href:"/contrast/pr-preview/pr-1840/next/howto/workload-deployment/deployment-verification",children:"Deployment verification"})," works as usual.\nVerifying that no manifest in the manifest history contained workload owner keys or seed share owner keys guarantees that no party can update and/or recover the deployment and its state."]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}}}]);