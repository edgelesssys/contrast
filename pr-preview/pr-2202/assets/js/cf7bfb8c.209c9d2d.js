"use strict";(globalThis.webpackChunkcontrast_docs=globalThis.webpackChunkcontrast_docs||[]).push([[11420],{28453(e,n,t){t.d(n,{R:()=>r,x:()=>a});var i=t(96540);const o={},s=i.createContext(o);function r(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(s.Provider,{value:n},e.children)}},78186(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"reference/node-installer-configuration","title":"Node installer configuration","description":"The Contrast node installer uses an optional ConfigMap to customize the installation process.","source":"@site/docs/reference/node-installer-configuration.md","sourceDirName":"reference","slug":"/reference/node-installer-configuration","permalink":"/contrast/pr-preview/pr-2202/next/reference/node-installer-configuration","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/contrast/edit/main/docs/docs/reference/node-installer-configuration.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Telemetry & data collection","permalink":"/contrast/pr-preview/pr-2202/next/architecture/telemetry"}}');var o=t(74848),s=t(28453);const r={},a="Node installer configuration",c={},l=[{value:"Applying the configuration",id:"applying-the-configuration",level:2},{value:"Configuration values",id:"configuration-values",level:2},{value:"<code>containerd-config-path</code>",id:"containerd-config-path",level:3},{value:"<code>systemd-unit-name</code>",id:"systemd-unit-name",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"node-installer-configuration",children:"Node installer configuration"})}),"\n",(0,o.jsxs)(n.p,{children:["The Contrast node installer uses an optional ",(0,o.jsx)(n.code,{children:"ConfigMap"})," to customize the installation process.\nSuch a ",(0,o.jsx)(n.code,{children:"CofigMap"})," must be called ",(0,o.jsx)(n.code,{children:"contrast-node-installer-target-config"})," and reside in the same namespace as the node installer.\nThe ",(0,o.jsx)(n.code,{children:"ConfigMap"})," is expected to contain one or more of the entries listed in the following sections.\nIf an entry is absent, the documented default value will be used.\nNote that an absent entry may be different from an entry with an empty value."]}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"ConfigMap"})," should only contain keys listed below.\nOther keys are reserved for future extensions."]})}),"\n",(0,o.jsx)(n.h2,{id:"applying-the-configuration",children:"Applying the configuration"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"contrast-node-installer-target-config"})," is configured as an optional ",(0,o.jsx)(n.code,{children:"ConfigMap"})," mount in the node installer.\nThis means that it must be applied before the runtime, applying it together with the runtime is often not enough."]}),"\n",(0,o.jsx)(n.p,{children:"If you need to modify or add the configuration after applying the runtime, you need to restart the node installer:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"kubectl rollout restart daemonset/contrast-cc-metal-qemu-snp-deadbeef\nkubectl rollout status -w daemonset/contrast-cc-metal-qemu-snp-deadbeef\n"})}),"\n",(0,o.jsx)(n.h2,{id:"configuration-values",children:"Configuration values"}),"\n",(0,o.jsx)(n.h3,{id:"containerd-config-path",children:(0,o.jsx)(n.code,{children:"containerd-config-path"})}),"\n",(0,o.jsxs)(n.p,{children:["The path to the containerd config relative to the node's file system root.\nThis configuration will be amended with an entry for the Contrast runtime class handler.\nIf the path ends with the ",(0,o.jsx)(n.code,{children:".tmpl"})," extension, the node installer assumes a ",(0,o.jsx)(n.a,{href:"https://docs.k3s.io/advanced#configuring-containerd",children:"k3s configuration template"}),", but overwrites it with the current rendered version."]}),"\n",(0,o.jsxs)(n.p,{children:["The default path is ",(0,o.jsx)(n.code,{children:"etc/containerd/config.toml"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"systemd-unit-name",children:(0,o.jsx)(n.code,{children:"systemd-unit-name"})}),"\n",(0,o.jsx)(n.p,{children:"A comma-separated list of systemd units to restart.\nThe node installer walks through this list until it finds a unit that's present on the node, and then attempts to restart it.\nIf none of the units exist, the node installer will fail the installation, exit and retry again in the next pod instance."}),"\n",(0,o.jsx)(n.p,{children:"If the list is empty, systemd units won't be restarted by the Contrast runtime.\nIn this case, an administrator must ensure that containerd picks up the new configuration file."}),"\n",(0,o.jsxs)(n.p,{children:["By default, the node installer attempts to restart ",(0,o.jsx)(n.code,{children:"containerd.service"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);