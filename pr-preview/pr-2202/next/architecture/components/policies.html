<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-architecture/components/policies" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Policies | Contrast</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.edgeless.systems/contrast/pr-preview/pr-2202/next/architecture/components/policies"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Policies | Contrast"><meta data-rh="true" name="description" content="Kata runtime policies are an integral part of Contrast."><meta data-rh="true" property="og:description" content="Kata runtime policies are an integral part of Contrast."><link data-rh="true" rel="icon" href="/contrast/pr-preview/pr-2202/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.edgeless.systems/contrast/pr-preview/pr-2202/next/architecture/components/policies"><link data-rh="true" rel="alternate" href="https://docs.edgeless.systems/contrast/pr-preview/pr-2202/next/architecture/components/policies" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.edgeless.systems/contrast/pr-preview/pr-2202/next/architecture/components/policies" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Policies","item":"https://docs.edgeless.systems/contrast/pr-preview/pr-2202/next/architecture/components/policies"}]}</script><script src="/contrast/gtagman.js" async data-cookieconsent="ignore"></script><link rel="stylesheet" href="/contrast/pr-preview/pr-2202/assets/css/styles.979edda2.css">
<script src="/contrast/pr-preview/pr-2202/assets/js/runtime~main.1bccb0bd.js" defer="defer"></script>
<script src="/contrast/pr-preview/pr-2202/assets/js/main.2c65b941.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme","light"),document.documentElement.setAttribute("data-theme-choice","light"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/contrast/pr-preview/pr-2202/img/logos/contrast_icon.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/contrast/pr-preview/pr-2202/"><div class="navbar__logo"><img src="/contrast/pr-preview/pr-2202/img/logos/contrast_icon.svg" alt="Contrast Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/contrast/pr-preview/pr-2202/img/logos/contrast_icon.svg" alt="Contrast Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/contrast/pr-preview/pr-2202/next/architecture/components/policies">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/contrast/pr-preview/pr-2202/next/architecture/components/policies">Next</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-2202/architecture/components/policies">1.17</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-2202/1.16/architecture/components/policies">1.16</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-2202/1.15/architecture/components/policies">1.15</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-2202/1.14/architecture/components/policies">1.14</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-2202/1.13/architecture/components/policies">1.13</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-2202/1.12/architecture/components/policies">1.12</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-2202/1.11/architecture/components/policies">1.11</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-2202/1.10">1.10</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-2202/1.9">1.9</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-2202/1.8">1.8</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-2202/1.7">1.7</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-2202/1.6">1.6</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-2202/1.5">1.5</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-2202/1.4">1.4</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-2202/1.3">1.3</a></li></ul></div><a href="https://github.com/edgelesssys/contrast" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/contrast/pr-preview/pr-2202/next"><span title="Introduction" class="linkLabel_WmDU">Introduction</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/contrast/pr-preview/pr-2202/next/getting-started/overview"><span title="Getting started" class="categoryLinkLabel_W154">Getting started</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/getting-started/overview"><span title="Overview" class="linkLabel_WmDU">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/getting-started/deployment"><span title="Workload deployment" class="linkLabel_WmDU">Workload deployment</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/contrast/pr-preview/pr-2202/next/howto/cluster-setup/bare-metal"><span title="How-to" class="categoryLinkLabel_W154">How-to</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/contrast/pr-preview/pr-2202/next/howto/cluster-setup/bare-metal"><span title="Cluster setup" class="categoryLinkLabel_W154">Cluster setup</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/howto/install-cli"><span title="Install CLI" class="linkLabel_WmDU">Install CLI</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/contrast/pr-preview/pr-2202/next/howto/workload-deployment/runtime-deployment"><span title="Workload deployment" class="categoryLinkLabel_W154">Workload deployment</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/howto/encrypted-storage"><span title="Set up encrypted volumes" class="linkLabel_WmDU">Set up encrypted volumes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/howto/hardening"><span title="Hardening" class="linkLabel_WmDU">Hardening</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/howto/logging"><span title="Logging" class="linkLabel_WmDU">Logging</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/howto/registry-authentication"><span title="Registry authentication" class="linkLabel_WmDU">Registry authentication</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/howto/observability"><span title="Observability" class="linkLabel_WmDU">Observability</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/howto/manifest-update"><span title="Manifest update" class="linkLabel_WmDU">Manifest update</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/howto/coordinator-ha"><span title="Coordinator high-availability" class="linkLabel_WmDU">Coordinator high-availability</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/howto/vault"><span title="Vault" class="linkLabel_WmDU">Vault</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/howto/secure-image-store"><span title="Secure image store" class="linkLabel_WmDU">Secure image store</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/howto/multi-runtime-class"><span title="Multi-runtime class" class="linkLabel_WmDU">Multi-runtime class</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/howto/immutable-deployments"><span title="Immutable deployments" class="linkLabel_WmDU">Immutable deployments</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/howto/troubleshooting"><span title="Troubleshooting" class="linkLabel_WmDU">Troubleshooting</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/howto/debugshell"><span title="Advanced debugging" class="linkLabel_WmDU">Advanced debugging</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/contrast/pr-preview/pr-2202/next/security"><span title="Security" class="linkLabel_WmDU">Security</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/contrast/pr-preview/pr-2202/next/architecture/overview"><span title="Architecture" class="categoryLinkLabel_W154">Architecture</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/architecture/overview"><span title="Overview" class="linkLabel_WmDU">Overview</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/contrast/pr-preview/pr-2202/next/architecture/components/runtime"><span title="Components" class="categoryLinkLabel_W154">Components</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/architecture/components/runtime"><span title="Runtime" class="linkLabel_WmDU">Runtime</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/contrast/pr-preview/pr-2202/next/architecture/components/policies"><span title="Policies" class="linkLabel_WmDU">Policies</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/architecture/components/initializer"><span title="Initializer" class="linkLabel_WmDU">Initializer</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/architecture/components/coordinator"><span title="Coordinator" class="linkLabel_WmDU">Coordinator</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/architecture/components/manifest"><span title="Manifest" class="linkLabel_WmDU">Manifest</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/architecture/components/service-mesh"><span title="Service mesh" class="linkLabel_WmDU">Service mesh</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/contrast/pr-preview/pr-2202/next/architecture/attestation/overview"><span title="Attestation" class="categoryLinkLabel_W154">Attestation</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/architecture/secrets"><span title="Secrets &amp; recovery" class="linkLabel_WmDU">Secrets &amp; recovery</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/architecture/k8s-yaml-elements"><span title="K8s YAML elements" class="linkLabel_WmDU">K8s YAML elements</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/architecture/features-limitations"><span title="Features &amp; limitations" class="linkLabel_WmDU">Features &amp; limitations</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-2202/next/architecture/telemetry"><span title="Telemetry &amp; data collection" class="linkLabel_WmDU">Telemetry &amp; data collection</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/contrast/pr-preview/pr-2202/next/reference/node-installer-configuration"><span title="Reference" class="categoryLinkLabel_W154">Reference</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Contrast<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/contrast/pr-preview/pr-2202/architecture/components/policies">latest version</a></b> (<!-- -->1.17<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/contrast/pr-preview/pr-2202/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Architecture</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Components</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Policies</span></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Policies</h1></header>
<p>Kata runtime policies are an integral part of Contrast.
They prescribe how a Kubernetes pod must be configured to launch successfully in a confidential VM.
In Contrast, policies act as a workload identifier: only pods with a policy referenced in the manifest receive workload certificates and may participate in the confidential deployment.
Verification of the Contrast Coordinator and its manifest transitively guarantees that all workloads meet the owner&#x27;s expectations.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="structure">Structure<a href="#structure" class="hash-link" aria-label="Direct link to Structure" title="Direct link to Structure" translate="no">​</a></h2>
<p>The Kata agent running in the confidential micro-VM exposes an RPC service <a href="https://github.com/kata-containers/kata-containers/blob/e5e0983/src/libs/protocols/protos/agent.proto#L21-L76" target="_blank" rel="noopener noreferrer" class=""><code>AgentService</code></a> to the Kata runtime.
This service handles potentially untrustworthy requests from outside the TCB, which need to be checked against a policy.</p>
<p>Kata runtime policies are written in the policy language <a href="https://www.openpolicyagent.org/docs/latest/policy-language/" target="_blank" rel="noopener noreferrer" class="">Rego</a>.
They specify what <code>AgentService</code> methods can be called, and the permissible parameters for each call.</p>
<p>Policies consist of two parts: a list of rules and a data section.
While the list of rules is static, the data section is populated with information from the <code>PodSpec</code> and other sources.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="generation">Generation<a href="#generation" class="hash-link" aria-label="Direct link to Generation" title="Direct link to Generation" translate="no">​</a></h2>
<p>Runtime policies are programmatically generated from Kubernetes manifests by the Contrast CLI.
During policy generation, the CLI walks over all pod-generating resources (<code>Pod</code> objects and controllers, such as <code>Deployment</code>) and derives policy data for each container.
There are two important checks for each container: image integrity and OCI runtime configuration integrity.</p>
<p>For image integrity, the CLI takes note of the image digest found during generate and configures the policy to enforce that exact same digest is requested by the runtime.
The image pull inside the VM only proceeds if the digests match.</p>
<p>For the OCI runtime configuration, the CLI combines information from the image layers and the <code>PodSpec</code> to derive a permissible set of command-line arguments and environment variables.
<code>ConfigMaps</code> and <code>Secrets</code> are also taken into account if they&#x27;re referenced in the <code>PodSpec</code> and present among the resources.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="evaluation">Evaluation<a href="#evaluation" class="hash-link" aria-label="Direct link to Evaluation" title="Direct link to Evaluation" translate="no">​</a></h2>
<p>The generated policy document is included in an initdata document, which is in turn annotated to the pod definitions.
This annotation is propagated to the Kata runtime, which calculates the SHA256 checksum for the initdata document and uses that as SNP <code>HOSTDATA</code> or TDX <code>MRCONFIGID</code> for the confidential micro-VM.</p>
<p>After the VM launched, the <code>initdata-processor</code> verifies the initdata document checksum against <code>HOSTDATA</code> or <code>MRCONFIGID</code>.
If that verification is successful, the contained policy is handed to the Kata agent, which uses it to validate all future <code>AgentService</code> requests.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Since the policy is annotated to the pod as part of the initdata document, it can be retrieved by any role with <code>get</code> or <code>list</code> permission for pods.
This may result in an unexpected leak of sensitive information, for example when the <a href="https://kubernetes.io/docs/tasks/inject-data-application/distribute-credentials-secure/#define-container-environment-variables-using-secret-data" target="_blank" rel="noopener noreferrer" class="">environment variables are populated from Kubernetes secrets</a>.</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="guarantees">Guarantees<a href="#guarantees" class="hash-link" aria-label="Direct link to Guarantees" title="Direct link to Guarantees" translate="no">​</a></h2>
<p>The policy evaluation provides the following guarantees for pods launched with the correct generated policy:</p>
<ul>
<li class="">Command and its arguments are set as specified in the resources.</li>
<li class="">There are no unexpected additional environment variables.</li>
<li class="">The container image configuration and layers are exactly those observed at policy generation time.</li>
<li class="">Executing additional processes in a container is prohibited.</li>
<li class="">Sending data to a container&#x27;s standard input is prohibited.</li>
</ul>
<p>The current implementation of policy checking has some blind spots:</p>
<ul>
<li class="">Containers can be started in any order, or be omitted entirely.</li>
<li class="">Environment variables that were present at generation time may be omitted by the runtime.</li>
<li class="">Volumes other than the container root volume don&#x27;t have integrity checks (particularly relevant for mounted <code>ConfigMaps</code> and <code>Secrets</code>).</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="trust">Trust<a href="#trust" class="hash-link" aria-label="Direct link to Trust" title="Direct link to Trust" translate="no">​</a></h2>
<p>Contrast verifies its confidential containers following these steps:</p>
<ol>
<li class="">The Contrast CLI generates a policy and attaches it to the pod definition.</li>
<li class="">Kubernetes schedules the pod on a node with the confidential computing runtime.</li>
<li class="">Containerd invokes the Kata runtime to create the pod sandbox.</li>
<li class="">The Kata runtime starts a CVM with the initdata digest as <code>HOSTDATA</code>/<code>MRCONFIGID</code>.</li>
<li class="">The <code>initdata-processor</code> verifies that the initdata document&#x27;s digest matches <code>HOSTDATA</code>/<code>MRCONFIGID</code>.</li>
<li class="">The <code>initdata-processor</code> writes the agent policy to a secure path in encrypted VM memory.</li>
<li class="">The CLI sets a manifest in the Contrast Coordinator, including a list of permitted initdata documents.</li>
<li class="">The Contrast Initializer sends an attestation report to the Contrast Coordinator, asking for a mesh certificate.</li>
<li class="">The Contrast Coordinator verifies that the started pod has a permitted initdata hash in its <code>HOSTDATA</code>/<code>MRCONFIGID</code> field.</li>
</ol>
<p>After the last step, we know that the policy hasn&#x27;t been tampered with and, thus, that the workload matches expectations and may receive mesh certificates.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="supported-resource-kinds">Supported resource kinds<a href="#supported-resource-kinds" class="hash-link" aria-label="Direct link to Supported resource kinds" title="Direct link to Supported resource kinds" translate="no">​</a></h2>
<p>Contrast policies can be generated for all built-in Kubernetes resource kinds that spawn pods, including:</p>
<ul>
<li class=""><code>CronJob</code></li>
<li class=""><code>DaemonSet</code></li>
<li class=""><code>Deployment</code></li>
<li class=""><code>Job</code></li>
<li class=""><code>Pod</code></li>
<li class=""><code>ReplicaSet</code></li>
<li class=""><code>ReplicationController</code></li>
</ul>
<p>The following resource kinds influence pod configuration and are also taken into account for policy generation:</p>
<ul>
<li class=""><code>ConfigMap</code></li>
<li class=""><code>Secret</code></li>
</ul>
<p>All other resource kinds are ignored by <code>contrast generate</code> and don&#x27;t influence the generated policy.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/edgelesssys/contrast/edit/main/docs/docs/architecture/components/policies.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/contrast/pr-preview/pr-2202/next/architecture/components/runtime"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Runtime</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/contrast/pr-preview/pr-2202/next/architecture/components/initializer"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Initializer</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#structure" class="table-of-contents__link toc-highlight">Structure</a></li><li><a href="#generation" class="table-of-contents__link toc-highlight">Generation</a></li><li><a href="#evaluation" class="table-of-contents__link toc-highlight">Evaluation</a></li><li><a href="#guarantees" class="table-of-contents__link toc-highlight">Guarantees</a></li><li><a href="#trust" class="table-of-contents__link toc-highlight">Trust</a></li><li><a href="#supported-resource-kinds" class="table-of-contents__link toc-highlight">Supported resource kinds</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.edgeless.systems/#footer-id" target="_blank" rel="noopener noreferrer" class="footer__link-item">Newsletter<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.edgeless.systems/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://twitter.com/EdgelessSystems" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/edgeless-systems/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCOOInN0sCv6icUesisYIDeA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.edgeless.systems/imprint/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Imprint<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.edgeless.systems/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="javascript: Cookiebot.renew()" class="footer__link-item">Cookie Settings</a></li><li class="footer__item"><a href="https://www.edgeless.systems/contact-us/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact Us<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Edgeless Systems</div></div></div></footer></div>
</body>
</html>