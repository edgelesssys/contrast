"use strict";(self.webpackChunkcontrast_docs=self.webpackChunkcontrast_docs||[]).push([[624],{28453:(e,o,t)=>{t.d(o,{R:()=>i,x:()=>s});var n=t(96540);const r={},a=n.createContext(r);function i(e){const o=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function s(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),n.createElement(a.Provider,{value:o},e.children)}},47755:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>i,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"howto/workload-deployment/deploy-coordinator","title":"Deploy Contrast Coordinator","description":"This step adds an additional service to you cluster. The Coordinator takes care of verifying your deployment.","source":"@site/docs/howto/workload-deployment/deploy-coordinator.md","sourceDirName":"howto/workload-deployment","slug":"/howto/workload-deployment/deploy-coordinator","permalink":"/contrast/pr-preview/pr-1436/next/howto/workload-deployment/deploy-coordinator","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/contrast/edit/main/docs/docs/howto/workload-deployment/deploy-coordinator.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Deploy application","permalink":"/contrast/pr-preview/pr-1436/next/howto/workload-deployment/deploy-application"},"next":{"title":"Verify deployment","permalink":"/contrast/pr-preview/pr-1436/next/howto/workload-deployment/deployment-verification"}}');var r=t(74848),a=t(28453);const i={},s="Deploy Contrast Coordinator",l={},d=[{value:"Applicability",id:"applicability",level:2},{value:"Prerequisite",id:"prerequisite",level:2},{value:"How-to",id:"how-to",level:2},{value:"Download the Contrast Coordinator resource",id:"download-the-contrast-coordinator-resource",level:3},{value:"Deploy the Coordinator",id:"deploy-the-coordinator",level:3},{value:"Connect to the Contrast Coordinator",id:"connect-to-the-contrast-coordinator",level:3},{value:"Set the manifest",id:"set-the-manifest",level:3}];function c(e){const o={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.header,{children:(0,r.jsx)(o.h1,{id:"deploy-contrast-coordinator",children:"Deploy Contrast Coordinator"})}),"\n",(0,r.jsx)(o.p,{children:"This step adds an additional service to you cluster. The Coordinator takes care of verifying your deployment."}),"\n",(0,r.jsx)(o.h2,{id:"applicability",children:"Applicability"}),"\n",(0,r.jsx)(o.p,{children:"This step is mandatory for all Contrast deployments."}),"\n",(0,r.jsx)(o.h2,{id:"prerequisite",children:"Prerequisite"}),"\n",(0,r.jsxs)(o.ol,{children:["\n",(0,r.jsx)(o.li,{children:(0,r.jsx)(o.a,{href:"/contrast/pr-preview/pr-1436/next/howto/cluster-setup/aks",children:"Set up cluster"})}),"\n",(0,r.jsx)(o.li,{children:(0,r.jsx)(o.a,{href:"/contrast/pr-preview/pr-1436/next/howto/install-cli",children:"Install CLI"})}),"\n",(0,r.jsx)(o.li,{children:(0,r.jsx)(o.a,{href:"/contrast/pr-preview/pr-1436/next/howto/workload-deployment/runtime-deployment",children:"Deploy the Contrast runtime"})}),"\n",(0,r.jsx)(o.li,{children:(0,r.jsx)(o.a,{href:"/contrast/pr-preview/pr-1436/next/howto/workload-deployment/deployment-file-preparation",children:"Prepare deployment files"})}),"\n",(0,r.jsx)(o.li,{children:(0,r.jsx)(o.a,{href:"/contrast/pr-preview/pr-1436/next/howto/workload-deployment/TLS-configuration",children:"Configure TLS (optional)"})}),"\n",(0,r.jsx)(o.li,{children:(0,r.jsx)(o.a,{href:"/contrast/pr-preview/pr-1436/next/howto/workload-deployment/GPU-configuration",children:"Enable GPU support (optional)"})}),"\n",(0,r.jsx)(o.li,{children:(0,r.jsx)(o.a,{href:"/contrast/pr-preview/pr-1436/next/howto/workload-deployment/generate-annotations",children:"Generate annotations and manifest"})}),"\n",(0,r.jsx)(o.li,{children:(0,r.jsx)(o.a,{href:"/contrast/pr-preview/pr-1436/next/howto/workload-deployment/deploy-application",children:"Deploy application"})}),"\n"]}),"\n",(0,r.jsx)(o.h2,{id:"how-to",children:"How-to"}),"\n",(0,r.jsx)(o.h3,{id:"download-the-contrast-coordinator-resource",children:"Download the Contrast Coordinator resource"}),"\n",(0,r.jsx)(o.p,{children:"You can choose whether to download and deploy the Coordinator manifest separately after deploying your application, or include it alongside your application resources and apply everything at once.\nNote that your workloads won't run until a valid manifest has been set."}),"\n",(0,r.jsx)(o.p,{children:"Download the Kubernetes resource of the Contrast Coordinator, comprising a single replica deployment and a LoadBalancer service. Put it next to your resources:"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-sh",children:"curl -fLO https://github.com/edgelesssys/contrast/releases/latest/download/coordinator.yml --output-dir deployment\n"})}),"\n",(0,r.jsx)(o.h3,{id:"deploy-the-coordinator",children:"Deploy the Coordinator"}),"\n",(0,r.jsx)(o.p,{children:"Deploy the Coordinator resource by applying its resource definition:"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-sh",children:"kubectl apply -f deployment/coordinator.yml\n\n"})}),"\n",(0,r.jsx)(o.h3,{id:"connect-to-the-contrast-coordinator",children:"Connect to the Contrast Coordinator"}),"\n",(0,r.jsx)(o.p,{children:"For the next steps, we will need to connect to the Coordinator. The released Coordinator resource\nincludes a LoadBalancer definition we can use."}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-sh",children:"coordinator=$(kubectl get svc coordinator -o=jsonpath='{.status.loadBalancer.ingress[0].ip}')\n"})}),"\n",(0,r.jsxs)(o.admonition,{title:"Port-forwarding of Confidential Containers",type:"info",children:[(0,r.jsxs)(o.p,{children:[(0,r.jsx)(o.code,{children:"kubectl port-forward"})," uses a Container Runtime Interface (CRI) method that isn't supported by the Kata shim.\nIf you can't use a public load balancer, you can deploy a port-forwarding pod to relay traffic to a Contrast pod:"]}),(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: port-forwarder-coordinator\nspec:\n  containers:\n    - name: port-forwarder\n      image: alpine/socat\n      args:\n        - -d\n        - TCP-LISTEN:1313,fork\n        - TCP:coordinator:1313\n      resources:\n        requests:\n          memory: 50Mi\n        limits:\n          memory: 50Mi\n"})}),(0,r.jsxs)(o.p,{children:["Upstream tracking issue: ",(0,r.jsx)(o.a,{href:"https://github.com/kata-containers/kata-containers/issues/1693",children:"https://github.com/kata-containers/kata-containers/issues/1693"}),"."]})]}),"\n",(0,r.jsx)(o.h3,{id:"set-the-manifest",children:"Set the manifest"}),"\n",(0,r.jsx)(o.p,{children:"Attest the Coordinator and set the manifest:"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-sh",children:'contrast set -c "${coordinator}:1313" resources/\n'})}),"\n",(0,r.jsx)(o.p,{children:"This will use the reference values from the manifest file to attest the Coordinator.\nAfter this step, the Coordinator will start issuing TLS certificates to the workloads. The init container\nwill fetch a certificate for the workload and the workload is started."})]})}function p(e={}){const{wrapper:o}={...(0,a.R)(),...e.components};return o?(0,r.jsx)(o,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);