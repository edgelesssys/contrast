"use strict";(self.webpackChunkcontrast_docs=self.webpackChunkcontrast_docs||[]).push([[188],{28453:(e,t,o)=>{o.d(t,{R:()=>a,x:()=>s});var n=o(96540);const r={},i=n.createContext(r);function a(e){const t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),n.createElement(i.Provider,{value:t},e.children)}},40256:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>a,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"howto/workload-deployment/set-manifest","title":"Set manifest","description":"Setting the manifest enables the Contrast Coordinator to verify the deployment.","source":"@site/versioned_docs/version-1.12/howto/workload-deployment/set-manifest.md","sourceDirName":"howto/workload-deployment","slug":"/howto/workload-deployment/set-manifest","permalink":"/contrast/pr-preview/pr-1718/howto/workload-deployment/set-manifest","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/contrast/edit/main/docs/versioned_docs/version-1.12/howto/workload-deployment/set-manifest.md","tags":[],"version":"1.12","frontMatter":{},"sidebar":"docs","previous":{"title":"Deploy application","permalink":"/contrast/pr-preview/pr-1718/howto/workload-deployment/deploy-application"},"next":{"title":"Verify deployment","permalink":"/contrast/pr-preview/pr-1718/howto/workload-deployment/deployment-verification"}}');var r=o(74848),i=o(28453);const a={},s="Set manifest",l={},d=[{value:"Applicability",id:"applicability",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"How-to",id:"how-to",level:2},{value:"Connect to the Contrast Coordinator",id:"connect-to-the-contrast-coordinator",level:3},{value:"Set manifest",id:"set-manifest-1",level:3}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"set-manifest",children:"Set manifest"})}),"\n",(0,r.jsx)(t.p,{children:"Setting the manifest enables the Contrast Coordinator to verify the deployment."}),"\n",(0,r.jsx)(t.h2,{id:"applicability",children:"Applicability"}),"\n",(0,r.jsx)(t.p,{children:"This step is mandatory for all Contrast deployments. Workloads won't start until a valid manifest has been configured."}),"\n",(0,r.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"/contrast/pr-preview/pr-1718/howto/cluster-setup/aks",children:"Set up cluster"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"/contrast/pr-preview/pr-1718/howto/install-cli",children:"Install CLI"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"/contrast/pr-preview/pr-1718/howto/workload-deployment/runtime-deployment",children:"Deploy the Contrast runtime"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"/contrast/pr-preview/pr-1718/howto/workload-deployment/add-coordinator",children:"Add Coordinator to resources"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"/contrast/pr-preview/pr-1718/howto/workload-deployment/deployment-file-preparation",children:"Prepare deployment files"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"/contrast/pr-preview/pr-1718/howto/workload-deployment/TLS-configuration",children:"Configure TLS (optional)"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"/contrast/pr-preview/pr-1718/howto/workload-deployment/GPU-configuration",children:"Enable GPU support (optional)"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"/contrast/pr-preview/pr-1718/howto/workload-deployment/generate-annotations",children:"Generate annotations and manifest"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"/contrast/pr-preview/pr-1718/howto/workload-deployment/deploy-application",children:"Deploy application"})}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"how-to",children:"How-to"}),"\n",(0,r.jsx)(t.h3,{id:"connect-to-the-contrast-coordinator",children:"Connect to the Contrast Coordinator"}),"\n",(0,r.jsx)(t.p,{children:"The released Coordinator resource\nincludes a LoadBalancer definition we can use."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sh",children:"coordinator=$(kubectl get svc coordinator -o=jsonpath='{.status.loadBalancer.ingress[0].ip}')\n"})}),"\n",(0,r.jsxs)(t.admonition,{title:"Port-forwarding of Confidential Containers",type:"info",children:[(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"kubectl port-forward"})," uses a Container Runtime Interface (CRI) method that isn't supported by the Kata shim.\nIf you can't use a public load balancer, you can deploy a port-forwarding pod to relay traffic to a Contrast pod:"]}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: port-forwarder-coordinator\nspec:\n  containers:\n    - name: port-forwarder\n      image: alpine/socat\n      args:\n        - -d\n        - TCP-LISTEN:1313,fork\n        - TCP:coordinator:1313\n      resources:\n        requests:\n          memory: 50Mi\n        limits:\n          memory: 50Mi\n"})}),(0,r.jsxs)(t.p,{children:["Upstream tracking issue: ",(0,r.jsx)(t.a,{href:"https://github.com/kata-containers/kata-containers/issues/1693",children:"https://github.com/kata-containers/kata-containers/issues/1693"}),"."]})]}),"\n",(0,r.jsx)(t.h3,{id:"set-manifest-1",children:"Set manifest"}),"\n",(0,r.jsx)(t.p,{children:"Attest the Coordinator and set the manifest:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sh",children:'contrast set -c "${coordinator}:1313" resources/\n'})}),"\n",(0,r.jsx)(t.p,{children:"This will use the reference values from the manifest file to attest the Coordinator. After this step, the Coordinator will start issuing TLS certificates to the workloads. The init container will fetch a certificate for the workload and the workload is started."})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);