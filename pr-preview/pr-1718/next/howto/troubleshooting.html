<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-howto/troubleshooting" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Troubleshooting | Contrast</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.edgeless.systems/contrast/pr-preview/pr-1718/next/howto/troubleshooting"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Troubleshooting | Contrast"><meta data-rh="true" name="description" content="This section provides guidance on diagnosing and resolving issues in your Contrast deployment."><meta data-rh="true" property="og:description" content="This section provides guidance on diagnosing and resolving issues in your Contrast deployment."><link data-rh="true" rel="icon" href="/contrast/pr-preview/pr-1718/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.edgeless.systems/contrast/pr-preview/pr-1718/next/howto/troubleshooting"><link data-rh="true" rel="alternate" href="https://docs.edgeless.systems/contrast/pr-preview/pr-1718/next/howto/troubleshooting" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.edgeless.systems/contrast/pr-preview/pr-1718/next/howto/troubleshooting" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Troubleshooting","item":"https://docs.edgeless.systems/contrast/pr-preview/pr-1718/next/howto/troubleshooting"}]}</script><script src="/contrast/gtagman.js" async data-cookieconsent="ignore"></script><link rel="stylesheet" href="/contrast/pr-preview/pr-1718/assets/css/styles.fceb5906.css">
<script src="/contrast/pr-preview/pr-1718/assets/js/runtime~main.9cf0163d.js" defer="defer"></script>
<script src="/contrast/pr-preview/pr-1718/assets/js/main.c78c3360.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/contrast/pr-preview/pr-1718/"><div class="navbar__logo"><img src="/contrast/pr-preview/pr-1718/img/logos/contrast_icon.svg" alt="Contrast Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/contrast/pr-preview/pr-1718/img/logos/contrast_icon.svg" alt="Contrast Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/contrast/pr-preview/pr-1718/next/howto/troubleshooting">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/contrast/pr-preview/pr-1718/next/howto/troubleshooting">Next</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-1718/howto/troubleshooting">1.12</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-1718/1.11/howto/troubleshooting">1.11</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-1718/1.10">1.10</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-1718/1.9">1.9</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-1718/1.8">1.8</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-1718/1.7">1.7</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-1718/1.6">1.6</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-1718/1.5">1.5</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-1718/1.4">1.4</a></li><li><a class="dropdown__link" href="/contrast/pr-preview/pr-1718/1.3">1.3</a></li></ul></div><a href="https://github.com/edgelesssys/contrast" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/contrast/pr-preview/pr-1718/next">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/contrast/pr-preview/pr-1718/next/getting-started/overview">Getting started</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-1718/next/getting-started/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-1718/next/getting-started/deployment">Workload deployment</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/contrast/pr-preview/pr-1718/next/howto/cluster-setup/bare-metal">How-to</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/contrast/pr-preview/pr-1718/next/howto/cluster-setup/bare-metal">Cluster setup</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-1718/next/howto/install-cli">Install CLI</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/contrast/pr-preview/pr-1718/next/howto/workload-deployment/runtime-deployment">Workload deployment</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-1718/next/howto/encrypted-storage">Set up encrypted volumes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-1718/next/howto/hardening">Hardening</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-1718/next/howto/logging">Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-1718/next/howto/observability">Observability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-1718/next/howto/manifest-update">Manifest update</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-1718/next/howto/coordinator-ha">Coordinator high-availability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/pr-preview/pr-1718/next/howto/vault">Vault</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/contrast/pr-preview/pr-1718/next/howto/troubleshooting">Troubleshooting</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/contrast/pr-preview/pr-1718/next/security">Security</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/contrast/pr-preview/pr-1718/next/architecture/overview">Architecture</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Contrast<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/contrast/pr-preview/pr-1718/howto/troubleshooting">latest version</a></b> (<!-- -->1.12<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/contrast/pr-preview/pr-1718/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">How-to</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Troubleshooting</span></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Troubleshooting</h1></header>
<p>This section provides guidance on diagnosing and resolving issues in your Contrast deployment.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="related-topics">Related topics<a href="#related-topics" class="hash-link" aria-label="Direct link to Related topics" title="Direct link to Related topics">​</a></h2>
<ul>
<li><a href="/contrast/pr-preview/pr-1718/next/howto/logging">Logging</a>: How to capture useful logs from your Contrast deployment.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="contrast-generate-returns-errors"><code>contrast generate</code> returns errors<a href="#contrast-generate-returns-errors" class="hash-link" aria-label="Direct link to contrast-generate-returns-errors" title="Direct link to contrast-generate-returns-errors">​</a></h2>
<p>Some workload configurations are known to be insecure or incompatible with Contrast.
If such a configuration is detected during policy generation, an error is logged and the command fails.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="images-with-volume-declarations-but-without-a-kubernetes-mount">Images with VOLUME declarations but without a Kubernetes mount<a href="#images-with-volume-declarations-but-without-a-kubernetes-mount" class="hash-link" aria-label="Direct link to Images with VOLUME declarations but without a Kubernetes mount" title="Direct link to Images with VOLUME declarations but without a Kubernetes mount">​</a></h3>
<p>During <code>contrast generate</code>, an error like the following is printed and the process returns with a non-zero exit code:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">level=ERROR msg=&quot;The following volumes declared in image config don&#x27;t have corresponding Kubernetes mounts: [\&quot;/data\&quot;]&quot;</span><br></span></code></pre></div></div>
<p>This error indicates that the container image declares a <a href="https://github.com/opencontainers/image-spec/blob/06e6b47e2ef69021d9f9bf2cfa5fe43a7e010c81/config.md?plain=1#L168-L170" target="_blank" rel="noopener noreferrer"><code>VOLUME</code></a>, but there is no Kubernetes volume mounted at that path (<code>/data</code> in the example).
Since it&#x27;s not clearly specified if or what a container runtime is supposed to mount in that case, all declared volumes need to have a corresponding explicit Kubernetes volume mount.
Depending on the needs of the application, this could either be an <a href="https://kubernetes.io/docs/concepts/storage/volumes/#emptydir" target="_blank" rel="noopener noreferrer"><code>emptyDir</code></a> or a <a href="/contrast/pr-preview/pr-1718/next/architecture/secrets#secure-persistence">Contrast-managed persistent volume</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pod-fails-to-start">Pod fails to start<a href="#pod-fails-to-start" class="hash-link" aria-label="Direct link to Pod fails to start" title="Direct link to Pod fails to start">​</a></h2>
<p>If the Coordinator or a workload pod fails to even start, it can be helpful to
look at the events of the pod during the startup process using the <code>describe</code>
command.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">namespace</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> events </span><span class="token parameter variable" style="color:#36acaa">--for</span><span class="token plain"> pod/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">coordinator-pod-name</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<p>Example output:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">LAST SEEN  TYPE     REASON  OBJECT             MESSAGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">32m        Warning  Failed  Pod/coordinator-0  kubelet  Error: failed to create containerd task: failed to create shim task: &quot;CreateContainerRequest is blocked by policy: ...</span><br></span></code></pre></div></div>
<p>A common error, as in this example, is that the container creation was blocked by the
policy. Potential reasons are a modification of the deployment YAML without updating
the policies afterward, or a version mismatch between Contrast components.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="regenerating-the-policies">Regenerating the policies<a href="#regenerating-the-policies" class="hash-link" aria-label="Direct link to Regenerating the policies" title="Direct link to Regenerating the policies">​</a></h3>
<p>To ensure there isn&#x27;t a mismatch between Kubernetes resource YAML and the annotated
policies, rerun</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">contrast generate</span><br></span></code></pre></div></div>
<p>on your deployment. If any of the policy annotations change, re-deploy with the updated policies.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pin-container-images">Pin container images<a href="#pin-container-images" class="hash-link" aria-label="Direct link to Pin container images" title="Direct link to Pin container images">​</a></h3>
<p>When generating the policies, Contrast will download the images specified in your deployment
YAML and include their cryptographic identity. If the image tag is moved to another
container image after the policy has been generated, the image downloaded at deploy time
will differ from the one at generation time, and the policy enforcement won&#x27;t allow the
container to be started in the pod VM.</p>
<p>To ensure the correct image is always used, pin the container image to a fixed <code>sha256</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">22.04@sha256</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">19478ce7fc2ffbce89df29fea5725a8d12e57de52eb9ea570890dc5852aac1ac</span><br></span></code></pre></div></div>
<p>This way, the same image will still be pulled when the container tag (<code>22.04</code>) is moved
to another image.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="validate-contrast-components-match">Validate Contrast components match<a href="#validate-contrast-components-match" class="hash-link" aria-label="Direct link to Validate Contrast components match" title="Direct link to Validate Contrast components match">​</a></h3>
<p>A version mismatch between Contrast components can cause policy validation or attestation
to fail. Each Contrast runtime is identifiable based on its (shortened) measurement value
used to name the runtime class version.</p>
<p>First, analyze which runtime class is currently installed in your cluster by running</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get runtimeclasses</span><br></span></code></pre></div></div>
<p>This should give you output similar to the following one.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                           HANDLER                                        AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">contrast-cc-metal-qemu-snp-7173acb5               contrast-cc-metal-qemu-snp-7173acb5               23h</span><br></span></code></pre></div></div>
<p>The output shows that there is a Contrast runtime class installed.</p>
<p>Next, check if the pod that won&#x27;t start has the correct runtime class configured, and the
Coordinator uses the exact same runtime:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">namespace</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> get </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">jsonpath</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;{.spec.runtimeClassName}&#x27;</span><span class="token plain"> pod/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">pod-name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">namespace</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> get </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">jsonpath</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;{.spec.runtimeClassName}&#x27;</span><span class="token plain"> pod/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">coordinator-pod-name</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<p>The output should list the runtime class the pod is using:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">contrast-cc-metal-qemu-snp-7173acb5</span><br></span></code></pre></div></div>
<p>Version information about the currently used CLI can be obtained via the <code>version</code> flag:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">contrast </span><span class="token parameter variable" style="color:#36acaa">--version</span><br></span></code></pre></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">contrast version v1.XX.X</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">container image versions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ghcr.io/edgelesssys/contrast/coordinator:v1.XX.X@sha256:</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ghcr.io/edgelesssys/contrast/initializer:v1.XX.X@sha256:</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ghcr.io/edgelesssys/contrast/service-mesh-proxy:v1.XX.X@sha256:</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ghcr.io/edgelesssys/contrast/node-installer-kata:v1.XX.X@sha256:</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ghcr.io/edgelesssys/contrast/node-installer-kata-gpu:v1.XX.X@sha256:</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reference values </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> Metal-QEMU-SNP platform:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    runtime handler:      contrast-cc-metal-qemu-snp-7173acb5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - launch digest:      6cf7f93545210549c25e4efde6878deabfb5357da1a50b0fc9126e1218d182402a5ba2400d708a3d054ba96d663a2918</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      default SNP TCB:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          bootloader:     </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          tee:            </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          snp:            </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          microcode:      </span><span class="token number" style="color:#36acaa">115</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    genpolicy version:    </span><span class="token number" style="color:#36acaa">3.15</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reference values </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> Metal-QEMU-TDX platform:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre></div></div>
<p>Check the output for the section with the platform you are using, for example <code>Metal-QEMU-SNP</code>.
The <code>runtime handler</code> must match the runtime class name of the pod that won&#x27;t start.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="contrast-attempts-to-pull-the-wrong-image-reference">Contrast attempts to pull the wrong image reference<a href="#contrast-attempts-to-pull-the-wrong-image-reference" class="hash-link" aria-label="Direct link to Contrast attempts to pull the wrong image reference" title="Direct link to Contrast attempts to pull the wrong image reference">​</a></h3>
<p>Containerd versions before <code>v2.0.0</code> have a bug that can lead to pulling image references that differ from the PodSpec.
The policy failure contains a line starting with <code>allow_create_container_input</code> at the very top.
This is the request received from the runtime and subject to policy enforcement.
The JSON contains a list of annotations nested under <code>.OCI.Annotations</code>.
Verify that the value for annotation key <code>io.kubernetes.cri.image-name</code> corresponds to an image in your PodSpec.
If it doesn&#x27;t, you need to remove that image entirely from the affected node, for example with <code>crictl</code>.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">crictl rmi </span><span class="token variable" style="color:#36acaa">$IMAGE</span><br></span></code></pre></div></div>
<p>Upstream backport that&#x27;s fixing the bug is pending: <a href="https://github.com/containerd/containerd/pull/11644" target="_blank" rel="noopener noreferrer">https://github.com/containerd/containerd/pull/11644</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="vm-runs-out-of-memory">VM runs out of memory<a href="#vm-runs-out-of-memory" class="hash-link" aria-label="Direct link to VM runs out of memory" title="Direct link to VM runs out of memory">​</a></h2>
<p>Since pod VMs are statically sized, it&#x27;s easier to run out of memory due to misconfigurations.
Setting the right memory limits is even more important on bare metal, where the image layers need to be stored in the guest memory, too.
If you see an error message like this, the VM doesn&#x27;t have enough space to pull images:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">LAST SEEN   TYPE      REASON      OBJECT                            MESSAGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2m31s       Warning   Failed      Pod/my-pod-76dc84fc75-6xn7s   Error: failed to create containerd task: failed to create shim task: failed to handle layer: hasher sha256: failed to unpack [...] No space left on device (os error 28)</span><br></span></code></pre></div></div>
<p>This error can be resolved by increasing the memory limit of the containers, see the <a href="/contrast/pr-preview/pr-1718/next/howto/workload-deployment/deployment-file-preparation#pod-resources">Workload deployment</a> guide.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="connection-to-coordinator-fails">Connection to Coordinator fails<a href="#connection-to-coordinator-fails" class="hash-link" aria-label="Direct link to Connection to Coordinator fails" title="Direct link to Connection to Coordinator fails">​</a></h2>
<p>Connections from the CLI to the Coordinator may fail due to a variety of reasons.
If the error happens during the attested TLS handshake, it will usually be reported as an error message of the following form:
<code>rpc error: code = &lt;GRPC ERROR CODE&gt; desc = connection error: desc = &quot;&lt;DESCRIPTION&gt;&quot;</code>.
The following table explains the reason for the error and suggests further debugging steps.</p>
<table><thead><tr><th>Description</th><th>Cause</th><th>Next steps</th></tr></thead><tbody><tr><td><code>transport: authentication handshake failed: EOF</code></td><td>Connection was closed before the Coordinator could send a certificate.</td><td>Check the load balancer.</td></tr><tr><td><code>received context error while waiting for new LB policy update: context deadline exceeded</code></td><td>The Coordinator didn&#x27;t send attestation documents before the deadline.</td><td>Check the Coordinator logs for issuer problems.</td></tr><tr><td><code>transport: authentication handshake failed: remote error: tls: internal error</code></td><td>Coordinator failed to issue attestation documents</td><td>Check the Coordinator logs for issuer problems.</td></tr><tr><td><code>transport: authentication handshake failed: no valid attestation document certificate extensions found</code></td><td>Coordinator served an unexpected certificate.</td><td>Check whether remote end is the Coordinator with port 1313; Compare versions of Coordinator and CLI.</td></tr><tr><td><code>transport: authentication handshake failed: tls: first record does not look like a TLS handshake</code></td><td>Coordinator didn&#x27;t serve TLS.</td><td>Check whether remote end is the Coordinator with port 1313.</td></tr><tr><td><code>transport: Error while dialing: dial tcp &lt;host:port&gt;: connect: connection refused</code></td><td>Coordinator port is closed.</td><td>Check connectivity to the Coordinator; Check coordinator readiness; Check load balancer is pointing to the Coordinator port 1313.</td></tr><tr><td><code>transport: authentication handshake failed: [...] validator tdx-0 failed: validating report data: quote field MR_CONFIG_ID is [...]. Expect [...]&quot;</code></td><td>Wrong Coordinator policy hash.</td><td>Compare versions of Coordinator and CLI</td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/edgelesssys/contrast/edit/main/docs/docs/howto/troubleshooting.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/contrast/pr-preview/pr-1718/next/howto/vault"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Vault</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/contrast/pr-preview/pr-1718/next/security"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Security</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#related-topics" class="table-of-contents__link toc-highlight">Related topics</a></li><li><a href="#contrast-generate-returns-errors" class="table-of-contents__link toc-highlight"><code>contrast generate</code> returns errors</a><ul><li><a href="#images-with-volume-declarations-but-without-a-kubernetes-mount" class="table-of-contents__link toc-highlight">Images with VOLUME declarations but without a Kubernetes mount</a></li></ul></li><li><a href="#pod-fails-to-start" class="table-of-contents__link toc-highlight">Pod fails to start</a><ul><li><a href="#regenerating-the-policies" class="table-of-contents__link toc-highlight">Regenerating the policies</a></li><li><a href="#pin-container-images" class="table-of-contents__link toc-highlight">Pin container images</a></li><li><a href="#validate-contrast-components-match" class="table-of-contents__link toc-highlight">Validate Contrast components match</a></li><li><a href="#contrast-attempts-to-pull-the-wrong-image-reference" class="table-of-contents__link toc-highlight">Contrast attempts to pull the wrong image reference</a></li></ul></li><li><a href="#vm-runs-out-of-memory" class="table-of-contents__link toc-highlight">VM runs out of memory</a></li><li><a href="#connection-to-coordinator-fails" class="table-of-contents__link toc-highlight">Connection to Coordinator fails</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.edgeless.systems/#footer-id" target="_blank" rel="noopener noreferrer" class="footer__link-item">Newsletter<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.edgeless.systems/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://twitter.com/EdgelessSystems" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/edgeless-systems/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCOOInN0sCv6icUesisYIDeA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.edgeless.systems/imprint/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Imprint<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.edgeless.systems/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="javascript: Cookiebot.renew()" class="footer__link-item">Cookie Settings</a></li><li class="footer__item"><a href="https://www.edgeless.systems/contact-us/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact Us<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Edgeless Systems</div></div></div></footer></div>
</body>
</html>