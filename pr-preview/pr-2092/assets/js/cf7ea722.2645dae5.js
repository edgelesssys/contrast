"use strict";(globalThis.webpackChunkcontrast_docs=globalThis.webpackChunkcontrast_docs||[]).push([[35076],{28453(e,n,t){t.d(n,{R:()=>o,x:()=>d});var s=t(96540);const r={},i=s.createContext(r);function o(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:n},e.children)}},97361(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"architecture/components/manifest","title":"The manifest","description":"The manifest is the configuration file for the Coordinator, defining your confidential deployment.","source":"@site/versioned_docs/version-1.16/architecture/components/manifest.md","sourceDirName":"architecture/components","slug":"/architecture/components/manifest","permalink":"/contrast/pr-preview/pr-2092/architecture/components/manifest","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/contrast/edit/main/docs/versioned_docs/version-1.16/architecture/components/manifest.md","tags":[],"version":"1.16","frontMatter":{},"sidebar":"docs","previous":{"title":"Coordinator","permalink":"/contrast/pr-preview/pr-2092/architecture/components/coordinator"},"next":{"title":"Service mesh","permalink":"/contrast/pr-preview/pr-2092/architecture/components/service-mesh"}}');var r=t(74848),i=t(28453);const o={},d="The manifest",c={},a=[{value:"<code>Policies</code>",id:"policies",level:2},{value:"<code>Policies.*.SANs</code>",id:"policies-sans",level:3},{value:"<code>Policies.*.WorkloadSecretID</code>",id:"policies-workload-secret-id",level:3},{value:"<code>Policies.*.Role</code>",id:"policies-role",level:3},{value:"<code>ReferenceValues</code>",id:"reference-values",level:2},{value:"<code>ReferenceValues.snp.*.ProductName</code>",id:"snp-product-name",level:3},{value:"<code>ReferenceValues.snp.*.TrustedMeasurement</code>",id:"snp-trusted-measurement",level:3},{value:"<code>ReferenceValues.snp.*.MinimumTCB</code>",id:"snp-minimum-tcb",level:3},{value:"<code>ReferenceValues.snp.*.MinimumTCB.BootloaderVersion</code>",id:"snp-tcb-bootloader-version",level:4},{value:"<code>ReferenceValues.snp.*.MinimumTCB.TEEVersion</code>",id:"snp-tcb-tee-version",level:4},{value:"<code>ReferenceValues.snp.*.MinimumTCB.SNPVersion</code>",id:"snp-tcb-snp-version",level:4},{value:"<code>ReferenceValues.snp.*.MinimumTCB.MicrocodeVersion</code>",id:"snp-tcb-microcode-version",level:4},{value:"<code>ReferenceValues.snp.*.MinimumTCB.FMCVersion</code>",id:"snp-tcb-fmc-version",level:4},{value:"<code>ReferenceValues.snp.*.GuestPolicy</code>",id:"snp-guest-policy",level:3},{value:"<code>ReferenceValues.snp.*.PlatformInfo</code>",id:"snp-platform-info",level:3},{value:"<code>ReferenceValues.snp.AllowedChipIDs</code>",id:"referencevaluessnpallowedchipids",level:3},{value:"<code>ReferenceValues.tdx.*.MrTd</code>",id:"tdx-mr-td",level:3},{value:"<code>ReferenceValues.tdx.*.MrSeam</code>",id:"tdx-mr-seam",level:3},{value:"<code>ReferenceValues.tdx.*.Rtmrs[4]</code>",id:"tdx-rtmrs",level:3},{value:"<code>ReferenceValues.tdx.*.Xfam</code>",id:"tdx-xfam",level:3},{value:"<code>ReferenceValues.tdx.AllowedPIIDs</code>",id:"referencevaluestdxallowedpiids",level:3},{value:"<code>WorkloadOwnerKeyDigests</code>",id:"workload-owner-key-digests",level:2},{value:"<code>SeedshareOwnerKeys</code>",id:"seedshare-owner-keys",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"the-manifest",children:"The manifest"})}),"\n",(0,r.jsxs)(n.p,{children:["The manifest is the configuration file for the Coordinator, defining your confidential deployment.\nIt's automatically generated from your deployment by the Contrast CLI and uses JSON format (",(0,r.jsx)(n.code,{children:"manifest.json"}),")."]}),"\n",(0,r.jsx)(n.p,{children:"The manifest has the following higher level structure:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "Policies": {\n    "<policy-hash>": {\n      "SANs": [ "<san1>", "<san2>", ... ],\n      "WorkloadSecretID": "<workload-secret-id>",\n      "Role": "<role>"\n    },\n    ...\n  },\n  "ReferenceValues": {\n    "snp": [\n      {\n        "ProductName": "<product-name>",\n        "TrustedMeasurement": "<trusted-measurement>",\n        "MinimumTCB": { },\n        "GuestPolicy": { },\n        "PlatformInfo": { }\n      },\n      ...\n    ],\n    "tdx": [\n      {\n        "MrTd": "<mr-td>",\n        "MrSeam": "<mr-seam>",\n        "Rtmrs": [ "<rtmr0>", "<rtmr1>", "<rtmr2>", "<rtmr3>" ],\n        "Xfam": "<xfam>"\n      },\n      ...\n    ]\n  },\n  "WorkloadOwnerKeyDigests": [ "<workload-owner-key-digest1>", "<workload-owner-key-digest2>", ... ],\n  "SeedshareOwnerKeys": [ "<seedshare-owner-key1>", "<seedshare-owner-key2>", ... ]\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"policies",children:(0,r.jsx)(n.code,{children:"Policies"})}),"\n",(0,r.jsx)(n.p,{children:"The identities of your Pods, represented by the hashes of their respective initdata documents."}),"\n",(0,r.jsx)(n.h3,{id:"policies-sans",children:(0,r.jsx)(n.code,{children:"Policies.*.SANs"})}),"\n",(0,r.jsx)(n.p,{children:"The Coordinator will add the Subject Alternative Names (SANs) to the workload certificate for the workload with the respective policy hash after verification.\nAllowed values are:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"IP addresses"}),"\n",(0,r.jsx)(n.li,{children:"URIs"}),"\n",(0,r.jsx)(n.li,{children:"DNS names"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["By default, the Contrast CLI will add two SANs for each workload on generate: The pod name as DNS name under which the pod can be reached inside the cluster,\nand a wildcard DNS name ",(0,r.jsx)(n.code,{children:"*"})," to allow the certificate to be used with any other hostname (for example an external load balancer).\nAs DNS is untrusted in the context of Contrast, issuing a wildcard certificate won't weaken the security of your workload.\nIn addition, the Coordinator will add the pod IP address to the certificate."]}),"\n",(0,r.jsx)(n.p,{children:"If the pod is exposed via a different IP than the pod IP, for example a load balancer, and you want to include that IP in the certificate for verification,\ninsert the desired IP address into the list of SANs.\nThe change could look like this:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-diff",children:'   "Policies": {\n     ...\n     "99dd77cbd7fe2c4e1f29511014c14054a21a376f7d58a48d50e9e036f4522f6b": {\n       "SANs": [\n         "web",\n-        "*"\n+        "*",\n+        "203.0.113.34"\n       ],\n     },\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Some authentication and authorization schemes rely on URI SANs in X.509 certificates.\nFor example, ",(0,r.jsx)(n.a,{href:"https://spiffe.io/docs/latest/spiffe-about/spiffe-concepts/#spiffe-id",children:"SPIFFE IDs"})," are URIs and are often found as certificate SANs.\nThe change to add such an URI SAN to the manifest could look like this:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-diff",children:'   "Policies": {\n     ...\n     "99dd77cbd7fe2c4e1f29511014c14054a21a376f7d58a48d50e9e036f4522f6b": {\n       "SANs": [\n         "web",\n-        "*"\n+        "*",\n+        "spiffe://acme.com/billing/payments"\n       ],\n     },\n'})}),"\n",(0,r.jsx)(n.h3,{id:"policies-workload-secret-id",children:(0,r.jsx)(n.code,{children:"Policies.*.WorkloadSecretID"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"WorkloadSecretID"})," is used in addition to the secret seed to derive the workload secret.\nIt's a non-interpreted string and defaults to the qualified Kubernetes resource name of the pod.\nAs long as the ",(0,r.jsx)(n.code,{children:"WorkloadSecretID"})," remains unchanged, the derived workload secret will remain stable across manifest updates and Coordinator recovery."]}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"/contrast/pr-preview/pr-2092/architecture/secrets#workload-secrets",children:"Workload secrets"})," for more information."]}),"\n",(0,r.jsx)(n.h3,{id:"policies-role",children:(0,r.jsx)(n.code,{children:"Policies.*.Role"})}),"\n",(0,r.jsxs)(n.p,{children:["Contrast role assigned to the workload.\nThe only supported value is ",(0,r.jsx)(n.code,{children:"coordinator"}),", which identifies the Coordinator within the manifest.\nWorkloads don't set this field."]}),"\n",(0,r.jsx)(n.h2,{id:"reference-values",children:(0,r.jsx)(n.code,{children:"ReferenceValues"})}),"\n",(0,r.jsx)(n.p,{children:"The remote attestation reference values for the confidential micro-VM that's the runtime environment of your Pods.\nThe reference values cover both the platform configuration as well as the guest TCB.\nThey're independent from the workload executed inside the Contrast pod VM and only differ between platforms or Contrast versions."}),"\n",(0,r.jsxs)(n.p,{children:["The reference values are grouped by confidential computing technology, there is a ",(0,r.jsx)(n.code,{children:"snp"})," and a ",(0,r.jsx)(n.code,{children:"tdx"})," section.\nEach of those sections contains a list of reference value sets.\nThe Coordinator will accept a workload if its attestation report matches ",(0,r.jsx)(n.em,{children:"any"})," of the listed reverence value sets exactly."]}),"\n",(0,r.jsx)(n.h3,{id:"snp-product-name",children:(0,r.jsx)(n.code,{children:"ReferenceValues.snp.*.ProductName"})}),"\n",(0,r.jsxs)(n.p,{children:["The product name of your platform.\n",(0,r.jsx)(n.code,{children:"Milan"})," and ",(0,r.jsx)(n.code,{children:"Genoa"})," are supported by Contrast."]}),"\n",(0,r.jsx)(n.h3,{id:"snp-trusted-measurement",children:(0,r.jsx)(n.code,{children:"ReferenceValues.snp.*.TrustedMeasurement"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"TrustedMeasurement"})," is a hash over the initial memory contents and state of the confidential VM.\nIt covers the guest firmware, the initrd and kernel as well as the kernel command line.\nThe kernel command line contains the dm-verity hash of the root filesystem, which contains all Contrast components that run inside the guest."]}),"\n",(0,r.jsxs)(n.p,{children:["It's the (launch) ",(0,r.jsx)(n.code,{children:"MEASUREMENT"})," from the SNP ",(0,r.jsx)(n.code,{children:"ATTESTATION_REPORT"}),", according to Table 23 in the ",(0,r.jsx)(n.a,{href:"https://www.amd.com/content/dam/amd/en/documents/developer/56860.pdf",children:"SEV ABI Spec"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"snp-minimum-tcb",children:(0,r.jsx)(n.code,{children:"ReferenceValues.snp.*.MinimumTCB"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"MinimumTCB"})," defines the minimum secure version numbers (SVNs) for the platform components.\nThe Contrast Coordinator compares these value against both the ",(0,r.jsx)(n.code,{children:"COMMITTED_TCB"})," and ",(0,r.jsx)(n.code,{children:"LAUNCH_TCB"}),",\nwhere the ",(0,r.jsx)(n.code,{children:"LAUNCH_TCB"})," is the TCB that was committed when the VM was first launched,\nand the ",(0,r.jsx)(n.code,{children:"COMMITTED_TCB"})," is the TCB that's currently committed on the platform.\nProvisional firmware isn't considered, as it can be rolled back by a malicious platform operator at any time."]}),"\n",(0,r.jsxs)(n.p,{children:["AMD doesn't provide an accessible way to acquire the latest TCB values for your platform.\nVisit the ",(0,r.jsx)(n.a,{href:"https://www.amd.com/en/developer/sev.html",children:"AMD SEV developer portal"})," and download the latest firmware package for your processor family.\nUnpack and inspect the contained release notes, which state the SNP firmware SVN (called ",(0,r.jsx)(n.code,{children:"SPL"})," (security patch level) in that document).\nContact your hardware vendor or BIOS firmware provider for information about the other TCB components"]}),"\n",(0,r.jsxs)(n.p,{children:["To check the current TCB level of your platform, use ",(0,r.jsx)(n.a,{href:"https://github.com/virtee/snphost",children:(0,r.jsx)(n.code,{children:"snphost"})}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"snphost show tcb\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-console",children:"Reported TCB: TCB Version:\n  Microcode:   72\n  SNP:         23\n  TEE:         0\n  Boot Loader: 9\n  FMC:         None\nPlatform TCB: TCB Version:\n  Microcode:   72\n  SNP:         23\n  TEE:         0\n  Boot Loader: 9\n  FMC:         None\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The values listed as ",(0,r.jsx)(n.code,{children:"Reported TCB"})," to should be greater or equal to the ",(0,r.jsx)(n.code,{children:"MinimumTCB"})," values in ",(0,r.jsx)(n.code,{children:"manifest.json"}),".\nThe ",(0,r.jsx)(n.code,{children:"Platform TCB"})," can be higher than the ",(0,r.jsx)(n.code,{children:"Reported TCB"}),", in this case, the platform has provisional firmware enrolled.\nContrast relies on the committed TCB values, as provisional firmware can be rolled back anytime by the platform operator."]}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:["The TCB values observed on the target platform using ",(0,r.jsx)(n.code,{children:"snphost"})," might not be trustworthy.\nYour channel to the system or the system itself might be compromised.\nThe deployed firmware could be outdated and vulnerable."]})}),"\n",(0,r.jsx)(n.h4,{id:"snp-tcb-bootloader-version",children:(0,r.jsx)(n.code,{children:"ReferenceValues.snp.*.MinimumTCB.BootloaderVersion"})}),"\n",(0,r.jsx)(n.p,{children:"SVN of the bootloader of the secure processor."}),"\n",(0,r.jsx)(n.h4,{id:"snp-tcb-tee-version",children:(0,r.jsx)(n.code,{children:"ReferenceValues.snp.*.MinimumTCB.TEEVersion"})}),"\n",(0,r.jsxs)(n.p,{children:["SVN of the OS of the secure processor.\nSee ",(0,r.jsx)(n.a,{href:"https://www.amd.com/content/dam/amd/en/documents/developer/56860.pdf",children:"SEV ABI Spec"}),", Section 2.2."]}),"\n",(0,r.jsx)(n.h4,{id:"snp-tcb-snp-version",children:(0,r.jsx)(n.code,{children:"ReferenceValues.snp.*.MinimumTCB.SNPVersion"})}),"\n",(0,r.jsxs)(n.p,{children:["SVN of the SNP firmware.\nSee ",(0,r.jsx)(n.a,{href:"https://www.amd.com/content/dam/amd/en/documents/developer/56860.pdf",children:"SEV ABI Spec"}),", Section 2.2."]}),"\n",(0,r.jsx)(n.h4,{id:"snp-tcb-microcode-version",children:(0,r.jsx)(n.code,{children:"ReferenceValues.snp.*.MinimumTCB.MicrocodeVersion"})}),"\n",(0,r.jsxs)(n.p,{children:["SVN of the CPU microcode.\nSee ",(0,r.jsx)(n.a,{href:"https://www.amd.com/content/dam/amd/en/documents/developer/56860.pdf",children:"SEV ABI Spec"}),", Section 2.2."]}),"\n",(0,r.jsx)(n.h4,{id:"snp-tcb-fmc-version",children:(0,r.jsx)(n.code,{children:"ReferenceValues.snp.*.MinimumTCB.FMCVersion"})}),"\n",(0,r.jsxs)(n.p,{children:["Always ",(0,r.jsx)(n.code,{children:"None"})," for Milan and Genoa platforms."]}),"\n",(0,r.jsx)(n.h3,{id:"snp-guest-policy",children:(0,r.jsx)(n.code,{children:"ReferenceValues.snp.*.GuestPolicy"})}),"\n",(0,r.jsxs)(n.p,{children:["This is the guest policy according to Section 4.3 of the ",(0,r.jsx)(n.a,{href:"https://www.amd.com/content/dam/amd/en/documents/developer/56860.pdf",children:"SEV ABI Spec"}),".\nIt's enforced during the launch of the confidential VM."]}),"\n",(0,r.jsx)(n.p,{children:"The guest policy is currently static in Contrast, values can't be changed."}),"\n",(0,r.jsx)(n.h3,{id:"snp-platform-info",children:(0,r.jsx)(n.code,{children:"ReferenceValues.snp.*.PlatformInfo"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"PLATFORM_INFO"})," structure according to Table 24 in the ",(0,r.jsx)(n.a,{href:"https://www.amd.com/content/dam/amd/en/documents/developer/56860.pdf",children:"SEV ABI Spec"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["This has some overlap with the ",(0,r.jsx)(n.a,{href:"#snp-guest-policy",children:(0,r.jsx)(n.code,{children:"GuestPolicy"})}),", but is checked as part of the attestation report."]}),"\n",(0,r.jsx)(n.h3,{id:"referencevaluessnpallowedchipids",children:(0,r.jsx)(n.code,{children:"ReferenceValues.snp.AllowedChipIDs"})}),"\n",(0,r.jsxs)(n.p,{children:["These are matched against the ",(0,r.jsx)(n.code,{children:"CHIP_ID"})," field from the SNP attestation report, as documented in Table 23 in the ",(0,r.jsx)(n.a,{href:"https://www.amd.com/content/dam/amd/en/documents/developer/56860.pdf",children:"SEV ABI Spec"}),".\nIf the list is empty or null, all chip IDs are accepted."]}),"\n",(0,r.jsx)(n.p,{children:"In case hardware is operated by you instead of a third party, or you are able to gain physical access to the hardware to audit it,\nyou can list the known-good chip IDs of the hardware to ensure that the hardware is genuine and operated in a trusted physical environment."}),"\n",(0,r.jsxs)(n.p,{children:["To show the chip ID of a system, use ",(0,r.jsx)(n.a,{href:"https://github.com/virtee/snphost",children:(0,r.jsx)(n.code,{children:"snphost"})}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"snphost show identifier\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The returned value can be inserted into the ",(0,r.jsx)(n.code,{children:"AllowedChipIDs"})," list."]}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsx)(n.p,{children:"The chip ID must be retrieved from a machine by physically accessing it.\nIf you retrieve the chip ID via a remote channel, your traffic could already be redirected to a hostile environment that allows an attacker physical access."})}),"\n",(0,r.jsx)(n.h3,{id:"tdx-mr-td",children:(0,r.jsx)(n.code,{children:"ReferenceValues.tdx.*.MrTd"})}),"\n",(0,r.jsxs)(n.p,{children:["The TD measurement register (",(0,r.jsx)(n.code,{children:"MRTD"}),") is a hash over the initial memory content of the confidential VM.\nThe initial memory content for Contrast is the OVMF guest firmware."]}),"\n",(0,r.jsxs)(n.p,{children:["See Table 3.50 (",(0,r.jsx)(n.code,{children:"TDINFO_BASE"}),") and Section 5.4.53.3.2 in the ",(0,r.jsx)(n.a,{href:"https://cdrdv2.intel.com/v1/dl/getContent/733579",children:"TDX ABI Spec"})," for more information."]}),"\n",(0,r.jsx)(n.h3,{id:"tdx-mr-seam",children:(0,r.jsx)(n.code,{children:"ReferenceValues.tdx.*.MrSeam"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"MrSeam"})," is the SHA384 hash of the TDX module that created the confidential VM, according to Table 3.46 (",(0,r.jsx)(n.code,{children:"TEE_TCB_INFO"}),") in the ",(0,r.jsx)(n.a,{href:"https://cdrdv2.intel.com/v1/dl/getContent/733579",children:"TDX ABI Spec"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["You should retrieve the TDX module via a trustworthy channel from Intel, for example by downloading the TDX module from ",(0,r.jsx)(n.a,{href:"https://github.com/intel/confidential-computing.tdx.tdx-module/releases",children:"Intel's GitHub repository"})," and hashing the module on a trusted machine.\nYou can also reproduce the release artifact by following the build instructions linked in the release notes."]}),"\n",(0,r.jsx)(n.p,{children:"You can check the hash of the in-use TDX module by executing"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"sha384sum /boot/efi/EFI/TDX/TDX-SEAM.so | cut -d' ' -f1\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:["The TDX module hash (",(0,r.jsx)(n.code,{children:"MrSeam"}),") observed on the target platform might not be trustworthy.\nYour channel to the system or the system itself might be compromised.\nMake sure to retrieve or reproduce the value on a trusted machine."]})}),"\n",(0,r.jsx)(n.h3,{id:"tdx-rtmrs",children:(0,r.jsx)(n.code,{children:"ReferenceValues.tdx.*.Rtmrs[4]"})}),"\n",(0,r.jsxs)(n.p,{children:["RTMRs are the runtime extendable measurement registers of TDX, as specified in Table 3.50 (",(0,r.jsx)(n.code,{children:"TDINFO_BASE"}),") in the ",(0,r.jsx)(n.a,{href:"https://cdrdv2.intel.com/v1/dl/getContent/733579",children:"TDX ABI Spec"}),".\nThey cover the guest firmware, the initrd and kernel as well as the kernel command line.\nThe kernel command line contains the dm-verity hash of the root filesystem, which contains all Contrast components that run inside the guest."]}),"\n",(0,r.jsx)(n.h3,{id:"tdx-xfam",children:(0,r.jsx)(n.code,{children:"ReferenceValues.tdx.*.Xfam"})}),"\n",(0,r.jsxs)(n.p,{children:["The extended features available mask (",(0,r.jsx)(n.code,{children:"XFAM"}),") determines the set of extended features available for use by the guest and is documented in Section 3.4.2 (",(0,r.jsx)(n.code,{children:"XFAM"}),") in the ",(0,r.jsx)(n.a,{href:"https://cdrdv2.intel.com/v1/dl/getContent/733579",children:"TDX ABI Spec"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"referencevaluestdxallowedpiids",children:(0,r.jsx)(n.code,{children:"ReferenceValues.tdx.AllowedPIIDs"})}),"\n",(0,r.jsxs)(n.p,{children:["These are matched against the ",(0,r.jsx)(n.code,{children:"PIID"})," field from the PCK certificate, as documented in section 1.3.5 of the ",(0,r.jsx)(n.a,{href:"https://api.trustedservices.intel.com/documents/Intel_SGX_PCK_Certificate_CRL_Spec-1.5.pdf",children:"SGX PCK Spec"}),".\nIf the list is empty or null, all PIIDs are accepted."]}),"\n",(0,r.jsx)(n.p,{children:"In case hardware is operated by you instead of a third party, or you are able to gain physical access to the hardware to audit it,\nyou can obtain the PIID with the following steps:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Install and run Intel's ",(0,r.jsx)(n.a,{href:"https://github.com/intel/confidential-computing.tee.dcap/blob/717f2a91ca732c3309b0c59d21757463133eb440/tools/PCKRetrievalTool/README.txt",children:(0,r.jsx)(n.code,{children:"PCKIDRetrievalTool"})}),".\nThis should place a CSV file in your working directory."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Retrieve the following fields from the CSV file:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"EncryptedPPID"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"PCE_ID"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"CPUSVN"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"PCE ISVSVN"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Use these values to ",(0,r.jsx)(n.a,{href:"https://api.portal.trustedservices.intel.com/content/documentation.html#pcs-certificate-v4",children:"request a PCK certificate from Intel PCS"}),".\nNote that the response contains intermediate certificates in the ",(0,r.jsx)(n.code,{children:"SGX-PCK-Certificate-Issuer-Chain"})," header that are required to verify the PCK certificate's signature."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Verify that the PCK certificate chains back to Intel's root, for example with ",(0,r.jsx)(n.code,{children:"openssl verify"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Parse the PCK certificate to find the SGX extension address:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"openssl asn1parse -in pck.pem\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Example output, showing the extension address ",(0,r.jsx)(n.code,{children:"624"})," right after its ASN.1 OID:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-txt",children:"  613:d=5  hl=2 l=   9 prim: OBJECT            :1.2.840.113741.1.13.1\n  624:d=5  hl=4 l= 554 prim: OCTET STRING      [HEX DUMP]: [...]\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Parse the SGX extension to find the PIID:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"openssl asn1parse -in pck.pem --strparse $ADDRESS\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Example output with ",(0,r.jsx)(n.code,{children:"ADDRESS=624"}),", showing the PIID right after its ASN.1 OID:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-txt",children:"  454:d=2  hl=2 l=  10 prim: OBJECT            :1.2.840.113741.1.13.1.6\n  466:d=2  hl=2 l=  16 prim: OCTET STRING      [HEX DUMP]:E90210702A2CC5AD9764F29DDC8FDE8C\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Copy the value shown after ",(0,r.jsx)(n.code,{children:"[HEX DUMP]"})," into the ",(0,r.jsx)(n.code,{children:"AllowedPIIDs"})," field."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsx)(n.p,{children:"The EncryptedPPID must be retrieved from a machine by physically accessing it.\nIf you retrieve this value via a remote channel, your traffic could already be redirected to a hostile environment that allows an attacker physical access."})}),"\n",(0,r.jsx)(n.h2,{id:"workload-owner-key-digests",children:(0,r.jsx)(n.code,{children:"WorkloadOwnerKeyDigests"})}),"\n",(0,r.jsx)(n.p,{children:"A list of workload owner public key digests.\nUsed for authenticating subsequent manifest updates."}),"\n",(0,r.jsxs)(n.p,{children:["By default, the list contains the digest of the key that was passed to the Contrast CLI on ",(0,r.jsx)(n.code,{children:"contrast generate"})," via the ",(0,r.jsx)(n.code,{children:"--add-workload-owner-key"})," flag.\nIf the flag wasn't used, the workload owner key was generated and stored in the workspace as ",(0,r.jsx)(n.code,{children:"workload-owner.pem"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["The Coordinator uses this list to authenticate manifest updates submitted via ",(0,r.jsx)(n.code,{children:"contrast set"}),".\nIf multiple workload owner keys are specified, any of the corresponding private keys can be used to set a new manifest."]}),"\n",(0,r.jsxs)(n.p,{children:["If the manifest is generated with the ",(0,r.jsx)(n.code,{children:"--disable-updates"})," flag, the ",(0,r.jsx)(n.code,{children:"WorkloadOwnerKeyDigests"})," list is empty.\nIn this case, updates to the manifest are disabled and the ",(0,r.jsx)(n.a,{href:"/contrast/pr-preview/pr-2092/howto/immutable-deployments",children:"deployment is immutable"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"seedshare-owner-keys",children:(0,r.jsx)(n.code,{children:"SeedshareOwnerKeys"})}),"\n",(0,r.jsx)(n.p,{children:"Public keys of seed share owners.\nUsed to authenticate user recovery and permission to handle the secret seed."}),"\n",(0,r.jsxs)(n.p,{children:["Setting a manifest where the ",(0,r.jsx)(n.code,{children:"WorkloadOwnerKeyDigests"})," has been removed will render the deployment ",(0,r.jsx)(n.a,{href:"/contrast/pr-preview/pr-2092/howto/immutable-deployments",children:"immutable"}),".\nDoing the same for the ",(0,r.jsx)(n.code,{children:"SeedshareOwnerKeys"})," field makes Coordinator recovery and workload secret recovery impossible."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}}}]);