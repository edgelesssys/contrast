"use strict";(self.webpackChunkcontrast_docs=self.webpackChunkcontrast_docs||[]).push([[4593],{28453:(e,o,t)=>{t.d(o,{R:()=>a,x:()=>s});var n=t(96540);const r={},i=n.createContext(r);function a(e){const o=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function s(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),n.createElement(i.Provider,{value:o},e.children)}},35543:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>a,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"howto/coordinator-ha","title":"Coordinator High-Availability","description":"This guide shows how to scale the Contrast Coordinator to more than one instance and make it highly available.","source":"@site/versioned_docs/version-1.12/howto/coordinator-ha.md","sourceDirName":"howto","slug":"/howto/coordinator-ha","permalink":"/contrast/pr-preview/pr-1761/1.12/howto/coordinator-ha","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/contrast/edit/main/docs/versioned_docs/version-1.12/howto/coordinator-ha.md","tags":[],"version":"1.12","frontMatter":{},"sidebar":"docs","previous":{"title":"Manifest update","permalink":"/contrast/pr-preview/pr-1761/1.12/howto/manifest-update"},"next":{"title":"Vault","permalink":"/contrast/pr-preview/pr-1761/1.12/howto/vault"}}');var r=t(74848),i=t(28453);const a={},s="Coordinator High-Availability",d={},l=[{value:"Applicability",id:"applicability",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"How-To",id:"how-to",level:2},{value:"How it works",id:"how-it-works",level:2}];function c(e){const o={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.header,{children:(0,r.jsx)(o.h1,{id:"coordinator-high-availability",children:"Coordinator High-Availability"})}),"\n",(0,r.jsx)(o.p,{children:"This guide shows how to scale the Contrast Coordinator to more than one instance and make it highly available."}),"\n",(0,r.jsx)(o.h2,{id:"applicability",children:"Applicability"}),"\n",(0,r.jsx)(o.p,{children:"Scaling the Coordinator increases availability and resilience of your Contrast deployment and reduces the amount of manual operations.\nIt's the recommended setup for running Contrast in production."}),"\n",(0,r.jsx)(o.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(o.p,{children:"A running Contrast deployment."}),"\n",(0,r.jsx)(o.h2,{id:"how-to",children:"How-To"}),"\n",(0,r.jsxs)(o.p,{children:["Deploy the Coordinator according to the ",(0,r.jsx)(o.a,{href:"/contrast/pr-preview/pr-1761/1.12/getting-started/deployment",children:"basic workflow"}),".\nBy default, there is only one Coordinator instance.\nVerify that this Coordinator is in state ",(0,r.jsx)(o.code,{children:"Ready"}),":"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-sh",children:"kubectl get pods -l app.kubernetes.io/name=coordinator\n"})}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-raw",children:"NAME            READY   STATUS    RESTARTS   AGE\ncoordinator-0   1/1     Running   0          11m\n"})}),"\n",(0,r.jsxs)(o.p,{children:["Next, we increase the number of instances to 3.\nThis will create additional Coordinator instances, one after another, as described in the ",(0,r.jsxs)(o.a,{href:"https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#deployment-and-scaling-guarantees",children:["Kubernetes documentation for ",(0,r.jsx)(o.code,{children:"StatefulSet"})]}),".\nAfter some time, the additional Coordinators should enter the ",(0,r.jsx)(o.code,{children:"Ready"})," state, too."]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-sh",children:"kubectl scale statefulset/coordinator --replicas 3\nkubectl wait statefulset/coordinator --for=jsonpath='{.status.readyReplicas}=3' --timeout=2m\nkubectl get pods -l app.kubernetes.io/name=coordinator\n"})}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-raw",children:"statefulset.apps/coordinator scaled\nstatefulset.apps/coordinator condition met\nNAME            READY   STATUS    RESTARTS   AGE\ncoordinator-0   1/1     Running   0          14m\ncoordinator-1   1/1     Running   0          107s\ncoordinator-2   1/1     Running   0          73s\n"})}),"\n",(0,r.jsx)(o.p,{children:"You can now try deleting individual Coordinator pods, draining a node in a multi-node cluster, or scheduling a full rollout of the Coordinator.\nAvailability of the Coordinator endpoint shouldn't be affected, and all Coordinator pods should automatically recover."}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-sh",children:"kubectl rollout restart statefulset/coordinator\nkubectl rollout status statefulset/coordinator -w\nkubectl get pods -l app.kubernetes.io/name=coordinator\n\n"})}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-raw",children:"statefulset.apps/coordinator restarted\nWaiting for 1 pods to be ready...\nWaiting for partitioned roll out to finish: 1 out of 3 new pods have been updated...\nWaiting for 1 pods to be ready...\nWaiting for 1 pods to be ready...\nWaiting for 1 pods to be ready...\nWaiting for partitioned roll out to finish: 2 out of 3 new pods have been updated...\nWaiting for 1 pods to be ready...\nWaiting for 1 pods to be ready...\nWaiting for 1 pods to be ready...\npartitioned roll out complete: 3 new pods have been updated...\nNAME            READY   STATUS    RESTARTS   AGE\ncoordinator-0   1/1     Running   0          41s\ncoordinator-1   1/1     Running   0          71s\ncoordinator-2   1/1     Running   0          99s\n"})}),"\n",(0,r.jsx)(o.h2,{id:"how-it-works",children:"How it works"}),"\n",(0,r.jsxs)(o.p,{children:["The Coordinator peer recovery mechanism is described on the ",(0,r.jsx)(o.a,{href:"/contrast/pr-preview/pr-1761/1.12/architecture/components/coordinator#peer-recovery",children:"Coordinator's component page"}),"."]})]})}function h(e={}){const{wrapper:o}={...(0,i.R)(),...e.components};return o?(0,r.jsx)(o,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);