"use strict";(self.webpackChunkcontrast_docs=self.webpackChunkcontrast_docs||[]).push([[744],{28453:(e,o,t)=>{t.d(o,{R:()=>i,x:()=>a});var r=t(96540);const n={},s=r.createContext(n);function i(e){const o=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function a(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),r.createElement(s.Provider,{value:o},e.children)}},38247:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"howto/workload-deployment/recover-coordinator","title":"Recover Contrast Coordinator","description":"This step describes how the Contrast Coordinator can be recovered after a restart.","source":"@site/docs/howto/workload-deployment/recover-coordinator.md","sourceDirName":"howto/workload-deployment","slug":"/howto/workload-deployment/recover-coordinator","permalink":"/contrast/pr-preview/pr-1791/next/howto/workload-deployment/recover-coordinator","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/contrast/edit/main/docs/docs/howto/workload-deployment/recover-coordinator.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Communicate with workloads","permalink":"/contrast/pr-preview/pr-1791/next/howto/workload-deployment/workload-communication"},"next":{"title":"Set up encrypted volumes","permalink":"/contrast/pr-preview/pr-1791/next/howto/encrypted-storage"}}');var n=t(74848),s=t(28453);const i={},a="Recover Contrast Coordinator",d={},c=[{value:"Applicability",id:"applicability",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"How-to",id:"how-to",level:2}];function l(e){const o={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.header,{children:(0,n.jsx)(o.h1,{id:"recover-contrast-coordinator",children:"Recover Contrast Coordinator"})}),"\n",(0,n.jsx)(o.p,{children:"This step describes how the Contrast Coordinator can be recovered after a restart."}),"\n",(0,n.jsx)(o.h2,{id:"applicability",children:"Applicability"}),"\n",(0,n.jsx)(o.p,{children:"This step is necessary only when the Coordinator needs to be restarted."}),"\n",(0,n.jsx)(o.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,n.jsxs)(o.ol,{children:["\n",(0,n.jsx)(o.li,{children:"A running Contrast deployment"}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"how-to",children:"How-to"}),"\n",(0,n.jsx)(o.p,{children:"This page guides you through the process of connecting to the Coordinator and restoring its state."}),"\n",(0,n.jsx)(o.p,{children:"If the Contrast Coordinator restarts, it enters recovery mode and waits for an operator to provide key material.\nFor demonstration purposes, you can simulate this scenario by deleting the Coordinator pod."}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-sh",children:"kubectl delete pod -l app.kubernetes.io/name=coordinator\n"})}),"\n",(0,n.jsxs)(o.p,{children:["Kubernetes schedules a new pod, but that pod doesn't have access to the key material the previous pod held in memory and can't issue certificates for workloads yet.\nYou can confirm this by running ",(0,n.jsx)(o.code,{children:"verify"})," again, or you can restart a workload pod, which should stay in the initialization phase.\nHowever, you can recover the Coordinator using the secret seed and the seed share owner key in your working directory."]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-sh",children:'contrast recover -c "${coordinator}:1313"\n'})}),"\n",(0,n.jsx)(o.p,{children:"Now that the Coordinator is recovered, all workloads should pass initialization and enter the running state.\nYou can now verify the Coordinator again, which should return the same manifest you set before."}),"\n",(0,n.jsx)(o.admonition,{type:"warning",children:(0,n.jsx)(o.p,{children:"The recovery process invalidates the mesh CA certificate:\nexisting workloads won't be able to communicate with workloads newly spawned.\nAll workloads should be restarted after the recovery succeeded."})})]})}function h(e={}){const{wrapper:o}={...(0,s.R)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}}}]);