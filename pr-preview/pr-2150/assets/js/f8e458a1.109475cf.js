"use strict";(globalThis.webpackChunkcontrast_docs=globalThis.webpackChunkcontrast_docs||[]).push([[73083],{28453(e,t,n){n.d(t,{R:()=>i,x:()=>l});var s=n(96540);const r={},o=s.createContext(r);function i(e){const t=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(o.Provider,{value:t},e.children)}},57503(e,t,n){n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"howto/workload-deployment/runtime-deployment","title":"Deploy the Contrast runtime","description":"This step configures the host environment on your Kubernetes worker nodes.","source":"@site/docs/howto/workload-deployment/runtime-deployment.md","sourceDirName":"howto/workload-deployment","slug":"/howto/workload-deployment/runtime-deployment","permalink":"/contrast/pr-preview/pr-2150/next/howto/workload-deployment/runtime-deployment","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/contrast/edit/main/docs/docs/howto/workload-deployment/runtime-deployment.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Install CLI","permalink":"/contrast/pr-preview/pr-2150/next/howto/install-cli"},"next":{"title":"Add Coordinator to resources","permalink":"/contrast/pr-preview/pr-2150/next/howto/workload-deployment/add-coordinator"}}');var r=n(74848),o=n(28453);const i={},l="Deploy the Contrast runtime",d={},a=[{value:"Applicability",id:"applicability",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"How-to",id:"how-to",level:2},{value:"Node installer configuration",id:"node-installer-configuration",level:3},{value:"Multi-runtime configurations",id:"multi-runtime-configurations",level:3}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,o.R)(),...e.components},{TabItem:n,Tabs:s}=t;return n||u("TabItem",!0),s||u("Tabs",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"deploy-the-contrast-runtime",children:"Deploy the Contrast runtime"})}),"\n",(0,r.jsx)(t.p,{children:"This step configures the host environment on your Kubernetes worker nodes."}),"\n",(0,r.jsx)(t.h2,{id:"applicability",children:"Applicability"}),"\n",(0,r.jsx)(t.p,{children:"Required for all Contrast deployments."}),"\n",(0,r.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"/contrast/pr-preview/pr-2150/next/howto/cluster-setup/bare-metal",children:"Set up cluster"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"/contrast/pr-preview/pr-2150/next/howto/install-cli",children:"Install CLI"})}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"how-to",children:"How-to"}),"\n",(0,r.jsxs)(t.p,{children:["Contrast depends on a ",(0,r.jsxs)(t.a,{href:"/contrast/pr-preview/pr-2150/next/architecture/components/runtime",children:["custom Kubernetes ",(0,r.jsx)(t.code,{children:"RuntimeClass"})," (",(0,r.jsx)(t.code,{children:"contrast-cc"}),")"]}),", which needs to be installed in the cluster prior to the Coordinator or any confidential workloads.\nThis consists of a ",(0,r.jsx)(t.code,{children:"RuntimeClass"})," resource and the node installer ",(0,r.jsx)(t.code,{children:"DaemonSet"})," that performs installation on worker nodes.\nThe node installer is deployed in the ",(0,r.jsx)(t.code,{children:"contrast-system"})," namespace by default but this can be changed by modifying the YAML files if you wish.\nThis step is only required once for each version of the runtime.\nIt can be shared between Contrast deployments.\nAlso, different Contrast runtime versions can be installed in the same cluster."]}),"\n",(0,r.jsxs)(s,{queryString:"platform",children:[(0,r.jsx)(n,{value:"metal-qemu-snp",label:"Bare metal (SEV-SNP)",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sh",children:"kubectl apply -f https://github.com/edgelesssys/contrast/releases/latest/download/runtime-metal-qemu-snp.yml\n"})})}),(0,r.jsx)(n,{value:"metal-qemu-snp-gpu",label:"Bare metal (SEV-SNP, with GPU support)",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sh",children:"kubectl apply -f https://github.com/edgelesssys/contrast/releases/latest/download/runtime-metal-qemu-snp-gpu.yml\n"})})}),(0,r.jsx)(n,{value:"metal-qemu-tdx",label:"Bare metal (TDX)",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sh",children:"kubectl apply -f https://github.com/edgelesssys/contrast/releases/latest/download/runtime-metal-qemu-tdx.yml\n"})})}),(0,r.jsx)(n,{value:"metal-qemu-tdx-gpu",label:"Bare metal (TDX, with GPU support)",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sh",children:"kubectl apply -f https://github.com/edgelesssys/contrast/releases/latest/download/runtime-metal-qemu-tdx-gpu.yml\n"})})})]}),"\n",(0,r.jsxs)(t.admonition,{title:"Modifications to containerd configuration",type:"warning",children:[(0,r.jsx)(t.p,{children:"The Contrast node installer will modify the containerd configuration on the worker nodes to add the runtime class.\nA backup will be created for the original configuration."}),(0,r.jsx)(t.p,{children:"Some Kubernetes platforms, for example K3s, use a template for the containerd configuration.\nNotice that Contrast can't modify these templates, but will write the templated version instead.\nAny modifications made to the template afterward won't take effect."})]}),"\n",(0,r.jsx)(t.h3,{id:"node-installer-configuration",children:"Node installer configuration"}),"\n",(0,r.jsx)(t.p,{children:"The node installer will perform the following steps on the node:"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Install the runtime binaries on the node's root file system."}),"\n",(0,r.jsx)(t.li,{children:"Add the Contrast runtime to the node's containerd configuration."}),"\n",(0,r.jsx)(t.li,{children:"Restart the node's systemd service for containerd."}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["The node installer can be configured with a ",(0,r.jsx)(t.code,{children:"ConfigMap"})," named ",(0,r.jsx)(t.code,{children:"contrast-node-installer-target-config"})," in the same namespace (",(0,r.jsx)(t.code,{children:"contrast-system"})," by default).\nEach key-value pair affects one of the above steps, as shown in the table."]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Key"}),(0,r.jsx)(t.th,{children:"Value semantics"}),(0,r.jsx)(t.th,{children:"Default"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"containerd-config-path"})}),(0,r.jsx)(t.td,{children:"Path to the containerd config relative to the node's file system root."}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"etc/containerd/config.toml"'})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"restart-systemd-unit"})}),(0,r.jsxs)(t.td,{children:["TODO(burgerdev): feels redundant with empty ",(0,r.jsx)(t.code,{children:"systemd-unit-name"})]}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"true"'})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"systemd-unit-name"})}),(0,r.jsx)(t.td,{children:"Comma-separated list of systemd units that should be restarted."}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"containerd.service"'})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"kata-config-path"})}),(0,r.jsx)(t.td,{children:"TODO(burgerdev): what does this do?"}),(0,r.jsx)(t.td,{children:"TODO(burgerdev)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"TODO(burgerdev): does not exist"}),(0,r.jsx)(t.td,{children:"directory where binaries are written to"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"/opt/edgeless/???"'})})]})]})]}),"\n",(0,r.jsx)(t.admonition,{type:"tip",children:(0,r.jsxs)(t.p,{children:["Contrast releases include a node installer configuration for ",(0,r.jsx)(t.a,{href:"https://k3s.io",children:"k3s"}),", see the ",(0,r.jsx)(t.a,{href:"/contrast/pr-preview/pr-2150/next/howto/cluster-setup/bare-metal#k3s",children:"bare metal setup guide"}),"."]})}),"\n",(0,r.jsx)(t.h3,{id:"multi-runtime-configurations",children:"Multi-runtime configurations"}),"\n",(0,r.jsx)(t.p,{children:"Depending on the configuration of your cluster and the workloads to deploy, it can be desirable to use different runtime classes for pods some pods.\nFor example, in a cluster consisting of both SEV-SNP and TDX machines, you might want to distribute the workload over all nodes."}),"\n",(0,r.jsxs)(t.p,{children:["Contrast supports these multi-runtime class configurations. For details, please see ",(0,r.jsx)(t.a,{href:"/contrast/pr-preview/pr-2150/next/howto/multi-runtime-class",children:"the multi-runtime class How To"}),"."]})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}function u(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}}}]);