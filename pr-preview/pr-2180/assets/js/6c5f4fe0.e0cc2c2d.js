"use strict";(globalThis.webpackChunkcontrast_docs=globalThis.webpackChunkcontrast_docs||[]).push([[44206],{23883(e,o,t){t.r(o),t.d(o,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"howto/workload-deployment/workload-communication","title":"Communicate with workloads","description":"\x3c!--TODO(katexochen): This section needs rework.","source":"@site/versioned_docs/version-1.16/howto/workload-deployment/workload-communication.md","sourceDirName":"howto/workload-deployment","slug":"/howto/workload-deployment/workload-communication","permalink":"/contrast/pr-preview/pr-2180/howto/workload-deployment/workload-communication","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/contrast/edit/main/docs/versioned_docs/version-1.16/howto/workload-deployment/workload-communication.md","tags":[],"version":"1.16","frontMatter":{},"sidebar":"docs","previous":{"title":"Verify deployment","permalink":"/contrast/pr-preview/pr-2180/howto/workload-deployment/deployment-verification"},"next":{"title":"Recover Contrast coordinator","permalink":"/contrast/pr-preview/pr-2180/howto/workload-deployment/recover-coordinator"}}');var r=t(74848),i=t(28453);const s={},a="Communicate with workloads",c={},l=[{value:"Applicability",id:"applicability",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"How-to",id:"how-to",level:2}];function d(e){const o={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.header,{children:(0,r.jsx)(o.h1,{id:"communicate-with-workloads",children:"Communicate with workloads"})}),"\n",(0,r.jsx)(o.p,{children:"This section explains how to use the Contrast service mesh to communicate with your application workloads."}),"\n",(0,r.jsx)(o.h2,{id:"applicability",children:"Applicability"}),"\n",(0,r.jsx)(o.p,{children:"This step is optional and only relevant if you have configured Contrast to use the service mesh PKI for incoming connections to your application."}),"\n",(0,r.jsx)(o.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(o.ol,{children:["\n",(0,r.jsx)(o.li,{children:"A running Contrast deployment"}),"\n",(0,r.jsx)(o.li,{children:(0,r.jsx)(o.a,{href:"/contrast/pr-preview/pr-2180/howto/workload-deployment/TLS-configuration",children:"Configure TLS"})}),"\n"]}),"\n",(0,r.jsx)(o.h2,{id:"how-to",children:"How-to"}),"\n",(0,r.jsxs)(o.p,{children:["You can securely connect to the workloads using the Coordinator's ",(0,r.jsx)(o.code,{children:"mesh-ca.pem"})," as a trusted CA certificate.\nFirst, expose the service on a public IP address via a LoadBalancer service:"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-sh",children:"kubectl patch svc ${MY_SERVICE} -p '{\"spec\": {\"type\": \"LoadBalancer\"}}'\nkubectl wait --timeout=30s --for=jsonpath='{.status.loadBalancer.ingress}' service/${MY_SERVICE}\nlbip=$(kubectl get svc ${MY_SERVICE} -o=jsonpath='{.status.loadBalancer.ingress[0].ip}')\necho $lbip\n"})}),"\n",(0,r.jsxs)(o.p,{children:["Using ",(0,r.jsx)(o.code,{children:"openssl"}),", the certificate of the service can be verified with the ",(0,r.jsx)(o.code,{children:"mesh-ca.pem"}),":"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-sh",children:"openssl s_client -CAfile verify/mesh-ca.pem -verify_return_error -connect ${frontendIP}:443 < /dev/null\n"})}),"\n",(0,r.jsxs)(o.admonition,{title:"Subject alternative names and LoadBalancer IP",type:"info",children:[(0,r.jsx)(o.p,{children:"By default, mesh certificates are issued with a wildcard DNS entry.\nHere, the service is accessed via its LoadBalancer IP address.\nTools like curl check the certificate for IP entries in the subject alternative name (SAN) field, which aren't present.\nFor example, attempting to connect with curl and the mesh CA certificate will throw the following error:"}),(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-sh",children:"$ curl --cacert ./verify/mesh-ca.pem \"https://${frontendIP}:443\"\ncurl: (60) SSL: no alternative certificate subject name matches target host name '203.0.113.34'\n"})}),(0,r.jsxs)(o.p,{children:["Check out the ",(0,r.jsx)(o.a,{href:"/contrast/pr-preview/pr-2180/architecture/components/manifest#policies-sans",children:"SANs section in the manifest reference"})," to learn how to add IP addresses to the SANs of your workload certificates."]})]})]})}function h(e={}){const{wrapper:o}={...(0,i.R)(),...e.components};return o?(0,r.jsx)(o,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453(e,o,t){t.d(o,{R:()=>s,x:()=>a});var n=t(96540);const r={},i=n.createContext(r);function s(e){const o=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function a(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),n.createElement(i.Provider,{value:o},e.children)}}}]);