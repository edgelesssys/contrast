"use strict";(self.webpackChunkcontrast_docs=self.webpackChunkcontrast_docs||[]).push([[6567],{28453:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>i});var n=s(96540);const o={},r=n.createContext(o);function a(e){const t=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),n.createElement(r.Provider,{value:t},e.children)}},41618:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>l,frontMatter:()=>a,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"howto/secured-image-storage","title":"Contrast secured image storage","description":"In order to reduce memory requirements, Contrast supports mounting an ephemeral volume into each pod-VM.","source":"@site/docs/howto/secured-image-storage.md","sourceDirName":"howto","slug":"/howto/secured-image-storage","permalink":"/contrast/pr-preview/pr-1685/next/howto/secured-image-storage","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/contrast/edit/main/docs/docs/howto/secured-image-storage.md","tags":[],"version":"current","frontMatter":{}}');var o=s(74848),r=s(28453);const a={},i="Contrast secured image storage",c={},d=[{value:"Configuration",id:"configuration",level:2}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"contrast-secured-image-storage",children:"Contrast secured image storage"})}),"\n",(0,o.jsxs)(t.p,{children:["In order to reduce memory requirements, Contrast supports mounting an ",(0,o.jsx)(t.a,{href:"https://kubernetes.io/docs/concepts/storage/ephemeral-volumes/",children:"ephemeral volume"})," into each pod-VM.\nBefore first use, the underlying block device issued by Kubernetes is LUKS-encrypted and integrity protected with keys generated inside the pod-VM.\nThese keys are never persisted or transferred outside of the pod-VM, meaning the volume is only usable from within the specific pod it's attached to, and only for the duration of that pod's lifetime."]}),"\n",(0,o.jsx)(t.h2,{id:"configuration",children:"Configuration"}),"\n",(0,o.jsxs)(t.p,{children:["By default, each pod receives a block device with a size of ",(0,o.jsx)(t.code,{children:"10Gi"}),".\nShould the sum of the uncompressed container image sizes exceed this amount, the size of the device can be increased on a per-pod level through an annotation:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-yaml",children:"metadata:\n  annotations:\n    contrast.edgeless.systems/image-store-size: 250Gi\n"})}),"\n",(0,o.jsxs)(t.p,{children:["To disable this feature for a specific pod, set the value of this annotation to ",(0,o.jsx)(t.code,{children:"0"}),":"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-yaml",children:"metadata:\n  annotations:\n    contrast.edgeless.systems/image-store-size: 0\n"})}),"\n",(0,o.jsxs)(t.p,{children:["To disable Contrast secure image store globally, specify the ",(0,o.jsx)(t.code,{children:"--skip-image-store"})," flag in the ",(0,o.jsx)(t.code,{children:"generate"})," command."]}),"\n",(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsxs)(t.p,{children:["If the Contrast secure image store feature is disabled, container images are pulled and uncompressed into encrypted memory.\nMemory limits must be adjusted accordingly.\nSee ",(0,o.jsx)(t.a,{href:"./workload-deployment/deployment-file-preparation#pod-resources",children:"Pod resources"})," for details."]})}),"\n",(0,o.jsxs)(t.admonition,{type:"warning",children:[(0,o.jsxs)(t.p,{children:["Currently, it's not possible to detect a ",(0,o.jsx)(t.a,{href:"https://github.com/confidential-containers/confidential-containers/issues/123#issuecomment-1644397221",children:"specific replay attack"})," by the host system wherein the host replaces the contents of the encrypted block device by a previously captured snapshot of the disk.\nSince the snapshot consists purely of ciphertext generated by the pod-VM, it reads as correctly integrity-protected and the pod-VM can't distinguish it from fresh data."]}),(0,o.jsxs)(t.p,{children:["Importantly, this ",(0,o.jsx)(t.strong,{children:"doesn't"})," allow a malicious host to decrypt the ciphertext stored on the device or to inject arbitrary data."]}),(0,o.jsx)(t.p,{children:"The trade-off between reduced resource requirements and a weakened security posture must be evaluated on a per-use-case basis."})]})]})}function l(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}}}]);