"use strict";(self.webpackChunkcontrast_docs=self.webpackChunkcontrast_docs||[]).push([[8986],{28453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>a});var t=n(96540);const i={},o=t.createContext(i);function r(e){const s=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(o.Provider,{value:s},e.children)}},56246:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"howto/secure-image-store","title":"Configuring the secure image store","description":"This section provides guidance on how to configure Contrast\'s secure image store feature, allowing you to adapt it to fit with your memory constraints and security requirements.","source":"@site/docs/howto/secure-image-store.md","sourceDirName":"howto","slug":"/howto/secure-image-store","permalink":"/contrast/pr-preview/pr-1685/next/howto/secure-image-store","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/contrast/edit/main/docs/docs/howto/secure-image-store.md","tags":[],"version":"current","frontMatter":{}}');var i=n(74848),o=n(28453);const r={},a="Configuring the secure image store",c={},l=[{value:"Applicability",id:"applicability",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"How-To",id:"how-to",level:2},{value:"Adjusting the size of the image store",id:"adjusting-the-size-of-the-image-store",level:3},{value:"Disabling the image store for a single pod",id:"disabling-the-image-store-for-a-single-pod",level:3},{value:"Disabling the image store globally",id:"disabling-the-image-store-globally",level:3},{value:"Memory considerations when disabling the secure image store",id:"memory-considerations-when-disabling-the-secure-image-store",level:2}];function d(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"configuring-the-secure-image-store",children:"Configuring the secure image store"})}),"\n",(0,i.jsx)(s.p,{children:"This section provides guidance on how to configure Contrast's secure image store feature, allowing you to adapt it to fit with your memory constraints and security requirements."}),"\n",(0,i.jsx)(s.h2,{id:"applicability",children:"Applicability"}),"\n",(0,i.jsx)(s.p,{children:"Storing container images on an encrypted ephemeral disk instead of in-memory reduces the amount of memory required.\nThis is especially beneficial in deployments with tight memory constraints, or if your container images are very large in size."}),"\n",(0,i.jsx)(s.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsx)(s.p,{children:"A running Contrast deployment."}),"\n",(0,i.jsx)(s.h2,{id:"how-to",children:"How-To"}),"\n",(0,i.jsxs)(s.p,{children:["The secure image store is enabled by default, providing each pod with ",(0,i.jsx)(s.code,{children:"10Gi"})," of storage.\nThis amount can be adjusted on a per-pod basis, the feature can be disabled for individual pods, or it can be disabled globally."]}),"\n",(0,i.jsxs)(s.p,{children:["Possible use-cases include increasing the limit to accommodate very large images, disabling the feature in scenarios where memory constraints are of no concern, or disabling it for ",(0,i.jsx)(s.a,{href:"./hardening#limitations-inherent-to-policy-checking",children:"hardening purposes"}),"."]}),"\n",(0,i.jsx)(s.h3,{id:"adjusting-the-size-of-the-image-store",children:"Adjusting the size of the image store"}),"\n",(0,i.jsx)(s.p,{children:"Add the following annotation to one of your pod definitions:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-yaml",children:"metadata: # v1.Pod, v1.PodTemplateSpec\n  annotations:\n    contrast.edgeless.systems/image-store-size: 250Gi\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Rerun ",(0,i.jsx)(s.code,{children:"contrast generate"})," and reapply your deployment for the change to take effect:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"contrast generate resources/\nkubectl apply -f resources/\n"})}),"\n",(0,i.jsx)(s.h3,{id:"disabling-the-image-store-for-a-single-pod",children:"Disabling the image store for a single pod"}),"\n",(0,i.jsxs)(s.p,{children:["To disable the secure image store for a specific pod, set the value of the shown annotation to ",(0,i.jsx)(s.code,{children:"0"}),", without a unit:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-yaml",children:"metadata: # v1.Pod, v1.PodTemplateSpec\n  annotations:\n    contrast.edgeless.systems/image-store-size: 0\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Rerun ",(0,i.jsx)(s.code,{children:"contrast generate"})," and reapply your deployment for the change to take effect:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"contrast generate resources/\nkubectl apply -f resources/\n"})}),"\n",(0,i.jsx)(s.h3,{id:"disabling-the-image-store-globally",children:"Disabling the image store globally"}),"\n",(0,i.jsxs)(s.p,{children:["To disable the image store globally, specify the ",(0,i.jsx)(s.code,{children:"--skip-image-store"})," flag in the ",(0,i.jsx)(s.code,{children:"contrast generate"})," command, then reapply your deployment:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"contrast generate --skip-image-store resources/\nkubectl apply -f resources/\n"})}),"\n",(0,i.jsx)(s.h2,{id:"memory-considerations-when-disabling-the-secure-image-store",children:"Memory considerations when disabling the secure image store"}),"\n",(0,i.jsxs)(s.p,{children:["If the Contrast secure image store feature is disabled, container images are pulled and uncompressed into encrypted memory.\nMemory limits must be adjusted accordingly.\nSee ",(0,i.jsx)(s.a,{href:"./workload-deployment/deployment-file-preparation#pod-resources",children:"Pod resources"})," for details."]})]})}function h(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);