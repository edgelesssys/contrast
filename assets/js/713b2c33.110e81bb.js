"use strict";(self.webpackChunkcontrast_docs=self.webpackChunkcontrast_docs||[]).push([[511],{24613:(o,e,t)=>{t.r(e),t.d(e,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"howto/coordinator-ha","title":"Coordinator High-Availability","description":"This guide shows how to scale the Contrast Coordinator to more than one instance and make it highly available.","source":"@site/versioned_docs/version-1.10/howto/coordinator-ha.md","sourceDirName":"howto","slug":"/howto/coordinator-ha","permalink":"/contrast/howto/coordinator-ha","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/contrast/edit/main/docs/versioned_docs/version-1.10/howto/coordinator-ha.md","tags":[],"version":"1.10","frontMatter":{},"sidebar":"docs","previous":{"title":"AMD SEV-SNP attestation","permalink":"/contrast/architecture/snp"},"next":{"title":"Registry authentication","permalink":"/contrast/howto/registry-authentication"}}');var r=t(74848),a=t(28453);const i={},s="Coordinator High-Availability",d={},l=[{value:"Workflow",id:"workflow",level:2},{value:"How it works",id:"how-it-works",level:2}];function c(o){const e={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,a.R)(),...o.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"coordinator-high-availability",children:"Coordinator High-Availability"})}),"\n",(0,r.jsx)(e.p,{children:"This guide shows how to scale the Contrast Coordinator to more than one instance and make it highly available."}),"\n",(0,r.jsx)(e.h2,{id:"workflow",children:"Workflow"}),"\n",(0,r.jsxs)(e.p,{children:["Deploy the Coordinator according to the ",(0,r.jsx)(e.a,{href:"/contrast/deployment",children:"basic workflow"}),".\nBy default, there is only one Coordinator instance.\nVerify that this Coordinator is in state ",(0,r.jsx)(e.code,{children:"Ready"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sh",children:"kubectl get pods -l app.kubernetes.io/name=coordinator\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-raw",children:"NAME            READY   STATUS    RESTARTS   AGE\ncoordinator-0   1/1     Running   0          11m\n"})}),"\n",(0,r.jsxs)(e.p,{children:["Next, we increase the number of instances to 3.\nThis will create additional Coordinator instances, one after another, as described in the ",(0,r.jsxs)(e.a,{href:"https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#deployment-and-scaling-guarantees",children:["Kubernetes documentation for ",(0,r.jsx)(e.code,{children:"StatefulSet"})]}),".\nAfter some time, the additional Coordinators should enter the ",(0,r.jsx)(e.code,{children:"Ready"})," state, too."]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sh",children:"kubectl scale statefulset/coordinator --replicas 3\nkubectl wait statefulset/coordinator --for=jsonpath='{.status.readyReplicas}=3' --timeout=2m\nkubectl get pods -l app.kubernetes.io/name=coordinator\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-raw",children:"statefulset.apps/coordinator scaled\nstatefulset.apps/coordinator condition met\nNAME            READY   STATUS    RESTARTS   AGE\ncoordinator-0   1/1     Running   0          14m\ncoordinator-1   1/1     Running   0          107s\ncoordinator-2   1/1     Running   0          73s\n"})}),"\n",(0,r.jsx)(e.p,{children:"You can now try deleting individual Coordinator pods, draining a node in a multi-node cluster, or scheduling a full rollout of the Coordinator.\nAvailability of the Coordinator endpoint shouldn't be affected, and all Coordinator pods should automatically recover."}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sh",children:"kubectl rollout restart statefulset/coordinator\nkubectl rollout status statefulset/coordinator -w\nkubectl get pods -l app.kubernetes.io/name=coordinator\n\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-raw",children:"statefulset.apps/coordinator restarted\nWaiting for 1 pods to be ready...\nWaiting for partitioned roll out to finish: 1 out of 3 new pods have been updated...\nWaiting for 1 pods to be ready...\nWaiting for 1 pods to be ready...\nWaiting for 1 pods to be ready...\nWaiting for partitioned roll out to finish: 2 out of 3 new pods have been updated...\nWaiting for 1 pods to be ready...\nWaiting for 1 pods to be ready...\nWaiting for 1 pods to be ready...\npartitioned roll out complete: 3 new pods have been updated...\nNAME            READY   STATUS    RESTARTS   AGE\ncoordinator-0   1/1     Running   0          41s\ncoordinator-1   1/1     Running   0          71s\ncoordinator-2   1/1     Running   0          99s\n"})}),"\n",(0,r.jsx)(e.h2,{id:"how-it-works",children:"How it works"}),"\n",(0,r.jsxs)(e.p,{children:["Newly started (or restarted) Coordinator instances try to recover from other Coordinator instances in the cluster.\nAs long as a single Coordinator is initialized, the other instances eventually recover from it.\n",(0,r.jsx)(e.code,{children:"StatefulSet"})," semantics guarantee that Coordinator pods are started predictably, and only after all existing Coordinators are recovered."]})]})}function h(o={}){const{wrapper:e}={...(0,a.R)(),...o.components};return e?(0,r.jsx)(e,{...o,children:(0,r.jsx)(c,{...o})}):c(o)}},28453:(o,e,t)=>{t.d(e,{R:()=>i,x:()=>s});var n=t(96540);const r={},a=n.createContext(r);function i(o){const e=n.useContext(a);return n.useMemo((function(){return"function"==typeof o?o(e):{...e,...o}}),[e,o])}function s(o){let e;return e=o.disableParentContext?"function"==typeof o.components?o.components(r):o.components||r:i(o.components),n.createElement(a.Provider,{value:e},o.children)}}}]);