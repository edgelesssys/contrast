<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-1.8 docs-doc-page docs-doc-id-architecture/snp" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">AMD SEV-SNP attestation | Contrast</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.edgeless.systems/contrast/1.8/architecture/snp"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="1.8"><meta data-rh="true" name="docusaurus_tag" content="docs-default-1.8"><meta data-rh="true" name="docsearch:version" content="1.8"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-1.8"><meta data-rh="true" property="og:title" content="AMD SEV-SNP attestation | Contrast"><meta data-rh="true" name="description" content="This page explains details of the AMD SEV-SNP attestation that are especially relevant for the implementation in Contrast."><meta data-rh="true" property="og:description" content="This page explains details of the AMD SEV-SNP attestation that are especially relevant for the implementation in Contrast."><link data-rh="true" rel="icon" href="/contrast/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.edgeless.systems/contrast/1.8/architecture/snp"><link data-rh="true" rel="alternate" href="https://docs.edgeless.systems/contrast/1.8/architecture/snp" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.edgeless.systems/contrast/1.8/architecture/snp" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"AMD SEV-SNP attestation","item":"https://docs.edgeless.systems/contrast/1.8/architecture/snp"}]}</script><script src="/contrast/gtagman.js" async data-cookieconsent="ignore"></script><link rel="stylesheet" href="/contrast/assets/css/styles.fceb5906.css">
<script src="/contrast/assets/js/runtime~main.806c233f.js" defer="defer"></script>
<script src="/contrast/assets/js/main.d6bd30b5.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_mb4j" style="background-color:#E7E6E6" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">Contrast is now open source! Check it out on <a target="_blank" rel="noopener noreferrer" href="https://github.com/edgelesssys/contrast">GitHub</a> and leave us a ⭐️ if you like it!</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/contrast/"><div class="navbar__logo"><img src="/contrast/img/logos/contrast_icon.svg" alt="Contrast Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/contrast/img/logos/contrast_icon.svg" alt="Contrast Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/contrast/1.8/architecture/snp">1.8</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/contrast/next">Next</a></li><li><a class="dropdown__link" href="/contrast/">1.11</a></li><li><a class="dropdown__link" href="/contrast/1.10/architecture/snp">1.10</a></li><li><a class="dropdown__link" href="/contrast/1.9/architecture/snp">1.9</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/contrast/1.8/architecture/snp">1.8</a></li><li><a class="dropdown__link" href="/contrast/1.7/architecture/snp">1.7</a></li><li><a class="dropdown__link" href="/contrast/1.6">1.6</a></li><li><a class="dropdown__link" href="/contrast/1.5">1.5</a></li><li><a class="dropdown__link" href="/contrast/1.4">1.4</a></li><li><a class="dropdown__link" href="/contrast/1.3">1.3</a></li></ul></div><a href="https://github.com/edgelesssys/contrast" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-1.8"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/contrast/1.8">What is Contrast?</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/contrast/1.8/basics/confidential-containers">Basics</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/1.8/basics/confidential-containers">Confidential Containers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/1.8/basics/security-benefits">Security benefits</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/1.8/basics/features">Features</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/contrast/1.8/getting-started/install">Getting started</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/1.8/getting-started/install">Install</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/1.8/getting-started/cluster-setup">Cluster setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/1.8/getting-started/bare-metal">Bare metal setup</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/contrast/1.8/examples/emojivoto">Examples</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/contrast/1.8/deployment">Workload deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/contrast/1.8/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/contrast/1.8/components/overview">Components</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/contrast/1.8/architecture/attestation">Architecture</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/1.8/architecture/attestation">Attestation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/1.8/architecture/secrets">Secrets &amp; recovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/1.8/architecture/certificates">Certificate authority</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/1.8/architecture/security-considerations">Security considerations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/1.8/architecture/observability">Observability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/contrast/1.8/architecture/snp">AMD SEV-SNP attestation</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/contrast/1.8/howto/registry-authentication">How-To</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/contrast/1.8/features-limitations">Planned features and limitations</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/contrast/1.8/about/telemetry">About</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Contrast<!-- --> <b>1.8</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/contrast/">latest version</a></b> (<!-- -->1.11<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/contrast/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Architecture</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">AMD SEV-SNP attestation</span></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 1.8</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>AMD SEV-SNP attestation</h1></header>
<p>This page explains details of the AMD SEV-SNP attestation that are especially relevant for the implementation in Contrast.
You should be familiar with <a href="/contrast/1.8/architecture/attestation">attestation basics</a>.
For more details on SEV-SNP, see the <a href="https://www.amd.com/en/developer/sev.html" target="_blank" rel="noopener noreferrer">whitepapers and specifications from AMD</a>.</p>
<p>The key component for attesting AMD SEV-SNP is the Secure Processor (SP).
It measures the confidential VM (CVM) and metadata and returns an attestation report reflecting those
measurements.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="startup">Startup<a href="#startup" class="hash-link" aria-label="Direct link to Startup" title="Direct link to Startup">​</a></h2>
<p>The SP extends the launch digest each time the hypervisor donates a page to the CVM during startup via <code>SNP_LAUNCH_UPDATE</code>. On an abstract level, the launch digest is extended as follows:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">LD := Hash(LD || Page || Page Metadata)</span><br></span></code></pre></div></div>
<p>When the Hypervisor calls <code>SNP_LAUNCH_FINISH</code>, it provides the SP with the <code>HOST_DATA</code>,
the <code>ID_BLOCK</code>, and <code>ID_AUTH</code> block.</p>
<p>The <code>HOST_DATA</code> is opaque to the SP. Kata writes the hash of the kata policy in
this field to bind the policy to the CVM. <code>HOST_DATA</code> is later reflected in the
attestation report.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="id-block-structure">ID block structure<a href="#id-block-structure" class="hash-link" aria-label="Direct link to ID block structure" title="Direct link to ID block structure">​</a></h3>
<p>The ID block contains fields that identify the VM.
The following table shows the fields that are relevant for Contrast.
The complete structure can be found in the SEV Secure Nested Paging Firmware ABI Specification in table 75.</p>
<table><thead><tr><th>Field</th><th>Description</th><th>Contrast usage</th></tr></thead><tbody><tr><td>LD</td><td>The expected launch digest of the guest.</td><td>Expected launch digest over kernel, initrd, and cmdline of the CVM.</td></tr><tr><td>POLICY</td><td>The policy of the guest.</td><td></td></tr></tbody></table>
<p>During startup, the SP compares the measurement it calculated to the <code>LD</code> in the ID block.
If they don&#x27;t match, the SP aborts the boot process.
Similarly, if the policy doesn&#x27;t match the configuration of the CVM, the SP aborts also.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="id-auth-structure">ID auth structure<a href="#id-auth-structure" class="hash-link" aria-label="Direct link to ID auth structure" title="Direct link to ID auth structure">​</a></h3>
<p>The ID auth structure exists to be able to verify the ID block structure.
A CVM image can be started with for example various different policies.
Moreover, the ID block itself can&#x27;t be verified later, since
it&#x27;s not part of the attestation report.
The intended use is that a trusted party creates an ECDSA-384 ID key pair
and signs the ID block structure. Both the signature and the public part of the
ID key are then passed via the hypervisor to the SP. The SP verifies the signature and
keeps a SHA-384 digest of the public key. The SP adds this digest in every attestation
report requested by the CVM.</p>
<p>The complete structure can be found in the SEV Secure Nested Paging Firmware ABI Specification in table 76.</p>
<table><thead><tr><th>Field</th><th>Description</th><th>Contrast usage</th></tr></thead><tbody><tr><td>ID_BLOCK_SIG</td><td>The signature of all bytes of the ID block.</td><td>Constant value of (r,s) = (2,1)</td></tr><tr><td>ID_KEY</td><td>The public component of the ID key.</td><td>Deterministically derived from the ID block and ID_BLOCK_SIG (see <a href="#anonymous-id-block-signing">Anonymous ID block signing</a>)</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="guest-policy-structure">Guest policy structure<a href="#guest-policy-structure" class="hash-link" aria-label="Direct link to Guest policy structure" title="Direct link to Guest policy structure">​</a></h3>
<p>The guest policy structure is embedded in the ID block in the <code>POLICY</code> field.
The complete structure can be found in the SEV Secure Nested Paging Firmware ABI Specification in table 10.</p>
<table><thead><tr><th>Field</th><th>Description</th><th>Value on cloud-hypervisor</th><th>Value on QEMU</th></tr></thead><tbody><tr><td>CIPHERTEXT_HIDING_DRAM</td><td>0: Ciphertext hiding for the DRAM may be enabled or disabled. <br>1: Ciphertext hiding for the DRAM must be enabled.</td><td>0</td><td>0</td></tr><tr><td>RAPL_DIS</td><td>0: Allow Running Average Power Limit (RAPL).  <br>1: RAPL must be disabled</td><td>0</td><td>0</td></tr><tr><td>MEM_AES_256_XTS</td><td>0: Allow either AES 128 XEX or AES 256 XTS for memory encryption. <br> 1: Require AES 256 XTS for memory encryption.</td><td>0</td><td>0</td></tr><tr><td>CXL_ALLOW</td><td>0: CXL can&#x27;t be populated with devices or memory. <br> 1: CXL can be populated with devices or memory.</td><td>0</td><td>0</td></tr><tr><td>SINGLE_SOCKET</td><td>0: Guest can be activated on multiple sockets. <br> 1: Guest can be activated only on one socket.</td><td>0</td><td>0</td></tr><tr><td>DEBUG</td><td>0: Debugging is disallowed. <br>  1: Debugging is allowed</td><td>0</td><td>0</td></tr><tr><td>MIGRATE_MA</td><td>0: Association with a migration agent is disallowed. <br> 1: Association with a migration agent is allowed.</td><td>0</td><td>0</td></tr><tr><td>SMT</td><td>0: SMT is disallowed. <br> 1: SMT is allowed.</td><td>1</td><td>1</td></tr><tr><td>ABI_MAJOR</td><td>The minimum ABI major version required for this guest to run.</td><td>0</td><td>0</td></tr><tr><td>ABI_MINOR</td><td>The minimum ABI minor version required for this guest to run.</td><td>31</td><td>0</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="attestation-report">Attestation report<a href="#attestation-report" class="hash-link" aria-label="Direct link to Attestation report" title="Direct link to Attestation report">​</a></h2>
<p>The attestation report is signed by the Versioned Chip Endorsement Key (VCEK).
The SP derives this key from the chip unique secret and the following REPORTED_TCB
information:</p>
<ol>
<li>SP bootloader SVN</li>
<li>SP OS SVN</li>
<li>SNP firmware SVN</li>
<li>Microcode patch level</li>
</ol>
<p>With those parameters, one can retrieve a certificate signing the VCEK from the
AMD Key Distribution Service (KDS) by querying <code>https://kdsintf.amd.com/vcek/v1/{product_name}/{hwid}?{params}</code></p>
<p>This VCEK certificate is signed by the AMD SEV CA certificate, which is signed by the AMD Root CA.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">AMD Root CA --&gt; AMD SEV CA --&gt; VCEK -- signs --&gt; Report</span><br></span></code></pre></div></div>
<p>The Contrast CLI embeds the AMD Root CA and AMD SEV CA certificate.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="attestation-report-structure">Attestation report structure<a href="#attestation-report-structure" class="hash-link" aria-label="Direct link to Attestation report structure" title="Direct link to Attestation report structure">​</a></h3>
<p>The following table shows the most important fields of the attestation report and how they&#x27;re used by Contrast.
The complete structure can be found in the SEV Secure Nested Paging Firmware ABI Specification in table 23.</p>
<table><thead><tr><th>Field</th><th>Description</th><th>Contrast usage</th></tr></thead><tbody><tr><td>VERSION</td><td>Version number of this attestation report. Set to <code>3h</code> for this specification.</td><td></td></tr><tr><td>PLATFORM_INFO</td><td>Information about the platform. See Table below</td><td></td></tr><tr><td>REPORT_DATA</td><td>If REQUEST_SOURCE is guest provided, then contains Guest-provided data, else host request and zero (0) filled by firmware.</td><td>Digest of nonce provided by the relying party and TLS public key of the CVM.</td></tr><tr><td>MEASUREMENT</td><td>The measurement calculated at launch.</td><td>Digest over kernel, initrd, and cmdline.</td></tr><tr><td>HOST_DATA</td><td>Data provided by the hypervisor at launch.</td><td>Digest of the kata policy.</td></tr><tr><td>ID_KEY_DIGEST</td><td>SHA-384 digest of the ID public key that signed the ID block provided in SNP_LAUNCH_FINISH.</td><td>Deterministic function of the SNP policy and launch digest in the ID_BLOCK. (see <a href="#anonymous-id-block-signing">Anonymous ID block signing</a>)</td></tr><tr><td>LAUNCH_TCB</td><td>The CurrentTcb at the time the guest was launched or imported.</td><td>Lowest TCB the guest ever executed with.</td></tr><tr><td>SIGNATURE</td><td>Signature of bytes <code>0h</code> to <code>29Fh</code> inclusive of this report.</td><td>Used to verify the integrity and authenticity of the report.</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="platform-info-structure">Platform info structure<a href="#platform-info-structure" class="hash-link" aria-label="Direct link to Platform info structure" title="Direct link to Platform info structure">​</a></h3>
<p>The platform info structure is embedded in the attestation report in the <code>PLATFORM_INFO</code> field.
The complete structure can be found in the SEV Secure Nested Paging Firmware ABI Specification in table 24.</p>
<table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td>ALIAS_CHECK_COMPLETE</td><td>Indicates that alias detection has completed since the last system reset and there are no aliasing addresses. Resets to 0. Contains mitigation for CVE-2024-21944.</td></tr><tr><td>CIPHERTEXT_HIDING_DRAM_EN</td><td>Indicates ciphertext hiding is enabled for the DRAM.</td></tr><tr><td>RAPL_DIS</td><td>Indicates that the RAPL feature is disabled.</td></tr><tr><td>ECC_EN</td><td>Indicates that the platform is using error correcting codes for memory. Present when EccMemReporting feature bit is set.</td></tr><tr><td>TSME_EN</td><td>Indicates that TSME is enabled in the system.</td></tr><tr><td>SMT_EN</td><td>Indicates that SMT is enabled in the system.</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="anonymous-id-block-signing">Anonymous ID block signing<a href="#anonymous-id-block-signing" class="hash-link" aria-label="Direct link to Anonymous ID block signing" title="Direct link to Anonymous ID block signing">​</a></h2>
<p>As described in <a href="#startup">startup</a>, the SP checks the signature of the ID block
with the public key provided in the ID auth block. The common usage of such signatures
is to know that a trusted party holding the private key has signed the ID block.
Since the ID block is part of for example the <a href="https://github.com/microsoft/igvm" target="_blank" rel="noopener noreferrer">IGVM</a> headers of
the VM image, they&#x27;re bound to the <code>runtimeClass</code> Contrast sets up
during <a href="/contrast/1.8/getting-started/install">installation</a>.
Therefore, the ID auth block and the signature and public key has to be provided by
Contrast, but the authors of Contrast shouldn&#x27;t be part of the TCB.</p>
<p>To have both the ability to sign ID blocks and not be part of the TCB, we must ensure
that there exists no private key for the <code>ID_KEY</code> in the ID auth structure.
For this, we implement ECDSA public key recovery. The algorithm is defined in <a href="https://www.secg.org/sec1-v2.pdf" target="_blank" rel="noopener noreferrer">SEC 1: Elliptic Curve Cryptography</a>.
The algorithm calculates an ECDSA public key given a message and its signature.
We keep the signature constant as <code>(r,s) = (2,1)</code> for all versions and
use the given ID block containing the guest policy and launch digest as an input.
The recovery algorithm returns two valid public keys. We choose the smaller one, meaning
the one with the smaller x value and, if equal, the one with the smaller y value.</p>
<p>Since we don&#x27;t generate any private key material during recovery and calculating the private
key from only the message, signature, and public key is cryptographically hard, no one
can forge (ID block, signature) combinations under the same public key.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/edgelesssys/contrast/edit/main/docs/versioned_docs/version-1.8/architecture/snp.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/contrast/1.8/architecture/observability"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Observability</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/contrast/1.8/howto/registry-authentication"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Registry authentication</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#startup" class="table-of-contents__link toc-highlight">Startup</a><ul><li><a href="#id-block-structure" class="table-of-contents__link toc-highlight">ID block structure</a></li><li><a href="#id-auth-structure" class="table-of-contents__link toc-highlight">ID auth structure</a></li><li><a href="#guest-policy-structure" class="table-of-contents__link toc-highlight">Guest policy structure</a></li></ul></li><li><a href="#attestation-report" class="table-of-contents__link toc-highlight">Attestation report</a><ul><li><a href="#attestation-report-structure" class="table-of-contents__link toc-highlight">Attestation report structure</a></li><li><a href="#platform-info-structure" class="table-of-contents__link toc-highlight">Platform info structure</a></li></ul></li><li><a href="#anonymous-id-block-signing" class="table-of-contents__link toc-highlight">Anonymous ID block signing</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.edgeless.systems/#footer-id" target="_blank" rel="noopener noreferrer" class="footer__link-item">Newsletter<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.edgeless.systems/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://twitter.com/EdgelessSystems" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/edgeless-systems/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCOOInN0sCv6icUesisYIDeA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.edgeless.systems/imprint/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Imprint<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.edgeless.systems/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="javascript: Cookiebot.renew()" class="footer__link-item">Cookie Settings</a></li><li class="footer__item"><a href="https://www.edgeless.systems/contact-us/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact Us<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Edgeless Systems</div></div></div></footer></div>
</body>
</html>