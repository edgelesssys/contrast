<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-howto/cluster-setup/bare-metal" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Prepare a bare-metal instance | Contrast</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.edgeless.systems/contrast/next/howto/cluster-setup/bare-metal"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Prepare a bare-metal instance | Contrast"><meta data-rh="true" name="description" content="Prerequisites"><meta data-rh="true" property="og:description" content="Prerequisites"><link data-rh="true" rel="icon" href="/contrast/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.edgeless.systems/contrast/next/howto/cluster-setup/bare-metal"><link data-rh="true" rel="alternate" href="https://docs.edgeless.systems/contrast/next/howto/cluster-setup/bare-metal" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.edgeless.systems/contrast/next/howto/cluster-setup/bare-metal" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Bare metal","item":"https://docs.edgeless.systems/contrast/next/howto/cluster-setup/bare-metal"}]}</script><script src="/contrast/gtagman.js" async data-cookieconsent="ignore"></script><link rel="stylesheet" href="/contrast/assets/css/styles.979edda2.css">
<script src="/contrast/assets/js/runtime~main.c87d8882.js" defer="defer"></script>
<script src="/contrast/assets/js/main.3f8bcc16.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme","light"),document.documentElement.setAttribute("data-theme-choice","light"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/contrast/img/logos/contrast_icon.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/contrast/"><div class="navbar__logo"><img src="/contrast/img/logos/contrast_icon.svg" alt="Contrast Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/contrast/img/logos/contrast_icon.svg" alt="Contrast Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/contrast/next/howto/cluster-setup/bare-metal">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/contrast/next/howto/cluster-setup/bare-metal">Next</a></li><li><a class="dropdown__link" href="/contrast/howto/cluster-setup/bare-metal">1.15</a></li><li><a class="dropdown__link" href="/contrast/1.14/howto/cluster-setup/bare-metal">1.14</a></li><li><a class="dropdown__link" href="/contrast/1.13/howto/cluster-setup/bare-metal">1.13</a></li><li><a class="dropdown__link" href="/contrast/1.12/howto/cluster-setup/bare-metal">1.12</a></li><li><a class="dropdown__link" href="/contrast/1.11/howto/cluster-setup/bare-metal">1.11</a></li><li><a class="dropdown__link" href="/contrast/1.10">1.10</a></li><li><a class="dropdown__link" href="/contrast/1.9">1.9</a></li><li><a class="dropdown__link" href="/contrast/1.8">1.8</a></li><li><a class="dropdown__link" href="/contrast/1.7">1.7</a></li><li><a class="dropdown__link" href="/contrast/1.6">1.6</a></li><li><a class="dropdown__link" href="/contrast/1.5">1.5</a></li><li><a class="dropdown__link" href="/contrast/1.4">1.4</a></li><li><a class="dropdown__link" href="/contrast/1.3">1.3</a></li></ul></div><a href="https://github.com/edgelesssys/contrast" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/contrast/next"><span title="Introduction" class="linkLabel_WmDU">Introduction</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/contrast/next/getting-started/overview"><span title="Getting started" class="categoryLinkLabel_W154">Getting started</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/next/getting-started/overview"><span title="Overview" class="linkLabel_WmDU">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/next/getting-started/deployment"><span title="Workload deployment" class="linkLabel_WmDU">Workload deployment</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/contrast/next/howto/cluster-setup/bare-metal"><span title="How-to" class="categoryLinkLabel_W154">How-to</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/contrast/next/howto/cluster-setup/bare-metal"><span title="Cluster setup" class="categoryLinkLabel_W154">Cluster setup</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/contrast/next/howto/cluster-setup/bare-metal"><span title="Bare metal" class="linkLabel_WmDU">Bare metal</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/next/howto/install-cli"><span title="Install CLI" class="linkLabel_WmDU">Install CLI</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/contrast/next/howto/workload-deployment/runtime-deployment"><span title="Workload deployment" class="categoryLinkLabel_W154">Workload deployment</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/next/howto/encrypted-storage"><span title="Set up encrypted volumes" class="linkLabel_WmDU">Set up encrypted volumes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/next/howto/hardening"><span title="Hardening" class="linkLabel_WmDU">Hardening</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/next/howto/logging"><span title="Logging" class="linkLabel_WmDU">Logging</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/next/howto/registry-authentication"><span title="Registry authentication" class="linkLabel_WmDU">Registry authentication</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/next/howto/observability"><span title="Observability" class="linkLabel_WmDU">Observability</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/next/howto/manifest-update"><span title="Manifest update" class="linkLabel_WmDU">Manifest update</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/next/howto/coordinator-ha"><span title="Coordinator high-availability" class="linkLabel_WmDU">Coordinator high-availability</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/next/howto/vault"><span title="Vault" class="linkLabel_WmDU">Vault</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/next/howto/secure-image-store"><span title="Secure image store" class="linkLabel_WmDU">Secure image store</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/next/howto/immutable-deployments"><span title="Immutable deployments" class="linkLabel_WmDU">Immutable deployments</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/next/howto/troubleshooting"><span title="Troubleshooting" class="linkLabel_WmDU">Troubleshooting</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contrast/next/howto/debugshell"><span title="Advanced debugging" class="linkLabel_WmDU">Advanced debugging</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/contrast/next/security"><span title="Security" class="linkLabel_WmDU">Security</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/contrast/next/architecture/overview"><span title="Architecture" class="categoryLinkLabel_W154">Architecture</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Contrast<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/contrast/howto/cluster-setup/bare-metal">latest version</a></b> (<!-- -->1.15<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/contrast/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">How-to</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Cluster setup</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Bare metal</span></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Prepare a bare-metal instance</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites" translate="no">​</a></h2>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">AMD SEV-SNP</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Intel TDX</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><ul>
<li class="">A supported CPU:<!-- -->
<ul>
<li class="">AMD Epyc 7003 series (Milan)</li>
<li class="">AMD Epyc 9004 series (Genoa)</li>
</ul>
</li>
</ul></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ul>
<li class="">A supported CPU:<!-- -->
<ul>
<li class="">5th Gen Intel Xeon Scalable Processor</li>
<li class="">Intel Xeon 6 Processors</li>
</ul>
</li>
<li class="">Platform must fulfill the <a href="https://cc-enabling.trustedservices.intel.com/intel-tdx-enabling-guide/03/hardware_selection/#dimm-ie-main-memory-requirements" target="_blank" rel="noopener noreferrer" class="">DIMM requirements</a>.</li>
</ul></div></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="hardware-and-firmware-setup">Hardware and firmware setup<a href="#hardware-and-firmware-setup" class="hash-link" aria-label="Direct link to Hardware and firmware setup" title="Direct link to Hardware and firmware setup" translate="no">​</a></h2>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">AMD SEV-SNP</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Intel TDX</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><ol>
<li class="">Update your BIOS to a version that supports AMD SEV-SNP. Updating to the latest available version is recommended as newer versions will likely contain security patches for AMD SEV-SNP.</li>
<li class="">Enter BIOS setup to enable SMEE, IOMMU, RMP coverage, and SEV-SNP. Set the SEV-ES ASID Space Limit to a non-zero number (higher is better).</li>
<li class="">Download the latest firmware version for your processor from <a href="https://www.amd.com/de/developer/sev.html" target="_blank" rel="noopener noreferrer" class="">AMD</a>, unpack it, and place it in <code>/lib/firmware/amd</code>.</li>
</ol><p>Consult AMD&#x27;s <a href="https://www.amd.com/content/dam/amd/en/documents/epyc-technical-docs/tuning-guides/58207-using-sev-with-amd-epyc-processors.pdf" target="_blank" rel="noopener noreferrer" class="">Using SEV with AMD EPYC Processors user guide</a> for more information.</p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>Follow Canonical&#x27;s instructions in <a href="https://github.com/canonical/tdx?tab=readme-ov-file#43-enable-intel-tdx-in-the-hosts-bios" target="_blank" rel="noopener noreferrer" class="">4.3 Enable Intel TDX in the Host&#x27;s BIOS</a> and <a href="https://github.com/canonical/tdx?tab=readme-ov-file#92-setup-intel-sgx-data-center-attestation-primitives-intel-sgx-dcap-on-the-host-os" target="_blank" rel="noopener noreferrer" class="">9.2 Setup Intel® SGX Data Center Attestation Primitives (Intel® SGX DCAP) on the Host OS</a> except for 9.2.1.</p><p>Instead of step 9.2.1, run the following:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> add-apt-repository ppa:kobuk-team/tdx-attestation-release</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;s/questing/plucky/g&#x27;</span><span class="token plain"> /etc/apt/sources.list.d/kobuk-team-ubuntu-tdx-attestation-release-*.sources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> sgx-dcap-pccs tdx-qgs libsgx-dcap-default-qpl sgx-ra-service sgx-pck-id-retrieval-tool</span><br></span></code></pre></div></div><p>You can ignore the other sections of the document.</p><p>Follow Intel&#x27;s guide to <a href="https://cc-enabling.trustedservices.intel.com/intel-tdx-enabling-guide/04/hardware_setup/#update-intel-tdx-module-via-binary-deployment" target="_blank" rel="noopener noreferrer" class="">Update Intel TDX Module via Binary Deployment</a>.
Intel recommends to install the latest TDX module version available.</p></div></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="kernel-setup">Kernel setup<a href="#kernel-setup" class="hash-link" aria-label="Direct link to Kernel setup" title="Direct link to Kernel setup" translate="no">​</a></h2>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">AMD SEV-SNP</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Intel TDX</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>Install Linux kernel 6.11 or greater.</p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>Install Ubuntu 25.10 and leave the kernel at the default version. Other distributions with a 6.16+ kernel might work as well, but we currently only provide support for Ubuntu 25.10.
Add the <code>nohibernate</code> and <code>kvm_intel.tdx=1</code> kernel command line parameters, for example by updating <code>GRUB_CMDLINE_LINUX</code> in <code>/etc/default/grub</code>.</p></div></div></div>
<p>Containerd uses a significant amount of <code>inotify</code> instances, so we recommend to allow at least 8192.
If necessary, the default can be increased by creating a config override file (for example in <code>/etc/sysctl.d/98-containerd.conf</code>) with the following content:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fs.inotify.max_user_instances = 8192</span><br></span></code></pre></div></div>
<p>Apply this change by running <code>systemctl restart systemd-sysctl</code> and verify it using <code>sysctl fs.inotify.max_user_instances</code>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="kubernetes-cluster-setup">Kubernetes cluster setup<a href="#kubernetes-cluster-setup" class="hash-link" aria-label="Direct link to Kubernetes cluster setup" title="Direct link to Kubernetes cluster setup" translate="no">​</a></h2>
<p>Contrast can be deployed with different Kubernetes distributions.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="k3s">K3s<a href="#k3s" class="hash-link" aria-label="Direct link to K3s" title="Direct link to K3s" translate="no">​</a></h3>
<p><a href="https://k3s.io/" target="_blank" rel="noopener noreferrer" class="">K3s</a> is a lightweight Kubernetes distribution that&#x27;s easy to set up.</p>
<ol>
<li class="">Follow the <a href="https://docs.k3s.io/" target="_blank" rel="noopener noreferrer" class="">K3s setup instructions</a> to create a cluster.
Contrast is currently tested with K3s version <code>v1.34.1+k3s1</code>.</li>
<li class="">Install a block storage provider such as <a href="https://longhorn.io/docs/1.9.1/deploy/install/install-with-helm/" target="_blank" rel="noopener noreferrer" class="">Longhorn</a> and mark it as the default storage class.</li>
<li class="">Ensure that a load balancer controller is installed.
For development and testing purposes, the built-in <a href="https://docs.k3s.io/networking/networking-services#service-load-balancer" target="_blank" rel="noopener noreferrer" class="">ServiceLB</a> should suffice.</li>
</ol>
<p>Then, install the ConfigMap to configure the Contrast node-installer for use with K3s:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> https://github.com/edgelesssys/contrast/releases/latest/download/node-installer-target-config-k3s.yml</span><br></span></code></pre></div></div>
<p>If you need to pull large images, configure K3s to use a longer <code>runtime-request-timeout</code> duration than the <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/" target="_blank" rel="noopener noreferrer" class="">default value of 2 minutes</a> used by the kubelet,
for example by setting</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubelet-arg:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - </span><span class="token string" style="color:#e3116c">&quot;runtime-request-timeout=5m&quot;</span><br></span></code></pre></div></div>
<p>in <code>/etc/rancher/k3s/config.yaml</code>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="preparing-a-cluster-for-gpu-usage">Preparing a cluster for GPU usage<a href="#preparing-a-cluster-for-gpu-usage" class="hash-link" aria-label="Direct link to Preparing a cluster for GPU usage" title="Direct link to Preparing a cluster for GPU usage" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="supported-gpu-hardware">Supported GPU hardware<a href="#supported-gpu-hardware" class="hash-link" aria-label="Direct link to Supported GPU hardware" title="Direct link to Supported GPU hardware" translate="no">​</a></h3>
<p>Contrast can only be used with the following Confidential Computing enabled GPUs:</p>
<ul>
<li class="">NVIDIA HGX B200, 8-GPU, SXM6 180GB HBM3e, AC</li>
<li class="">NVIDIA HGX B200-850, 8-GPU, SXM6 180GB HBM3e, AC</li>
<li class="">NVIDIA HGX H100 4-GPU 64GB HBM2e (Partner Cooled)</li>
<li class="">NVIDIA HGX H100 4-GPU 80GB HBM3 (Partner Cooled)</li>
<li class="">NVIDIA HGX H100 4-GPU 94GB HBM2e (Partner Cooled)</li>
<li class="">NVIDIA HGX H100 8-GPU 80GB (Air Cooled)</li>
<li class="">NVIDIA HGX H100 8-GPU 96GB (Air Cooled)</li>
<li class="">NVIDIA HGX H20 141GB HBM3e 8-GPU (Air Cooled)</li>
<li class="">NVIDIA HGX H200 8-GPU 141GB (Air Cooled)</li>
<li class="">NVIDIA HGX H20A HBM3 96GB 8-GPU (Air Cooled)</li>
<li class="">NVIDIA HGX H800 8-GPU 80GB (Air Cooled)</li>
<li class="">NVIDIA HGX H800 8-GPU 80GB (Partner Cooled)</li>
<li class="">NVIDIA H100 NVL</li>
<li class="">NVIDIA H100 PCIe</li>
<li class="">NVIDIA H200 NVL</li>
<li class="">NVIDIA H800 NVL</li>
<li class="">NVIDIA H800 PCIe</li>
<li class="">NVIDIA RTX PRO 6000 Blackwell Server Edition</li>
</ul>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Currently, only the <code>NVIDIA H100 PCIe</code> and <code>NVIDIA HGX B200</code> models are covered by tests. Other GPUs aren&#x27;t guaranteed to work.</p></div></div>
<p>To check what GPUs are available on your system, run:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lspci </span><span class="token parameter variable" style="color:#36acaa">-nnk</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;3D controller&#x27;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-A3</span><br></span></code></pre></div></div>
<div class="language-shell-session codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell-session codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token output">41:00.0 3D controller [0302]: NVIDIA Corporation GH100 [H100 PCIe] [10de:2331] (rev a1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token output">   Subsystem: NVIDIA Corporation GH100 [H100 PCIe] [10de:1626]</span><br></span><span class="token-line" style="color:#393A34"><span class="token output">   Kernel driver in use: vfio-pci</span><br></span><span class="token-line" style="color:#393A34"><span class="token output">   Kernel modules: nvidiafb, nouveau</span><br></span></code></pre></div></div>
<p>Further information is provided in <a href="https://www.nvidia.com/en-us/data-center/solutions/confidential-computing/secure-ai-compatibility-matrix/" target="_blank" rel="noopener noreferrer" class="">NVIDIA&#x27;s Secure AI Compatibility Matrix</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="setup">Setup<a href="#setup" class="hash-link" aria-label="Direct link to Setup" title="Direct link to Setup" translate="no">​</a></h3>
<p>To enable GPU usage on a Contrast cluster, some conditions need to be fulfilled for <em>each cluster node</em> that should host GPU workloads:</p>
<ol>
<li class="">
<p>You must activate the IOMMU. You can check by running:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> /sys/kernel/iommu_groups</span><br></span></code></pre></div></div>
<p>If the output contains the group indices (<code>0</code>, <code>1</code>, ...), the IOMMU is supported on the host.
Otherwise, add <code>intel_iommu=on</code> to the kernel command line.</p>
</li>
<li class="">
<p>Additionally, the host kernel needs to have the following kernel configuration options enabled:</p>
<ul>
<li class=""><code>CONFIG_VFIO</code></li>
<li class=""><code>CONFIG_VFIO_IOMMU_TYPE1</code></li>
<li class=""><code>CONFIG_VFIO_MDEV</code></li>
<li class=""><code>CONFIG_VFIO_MDEV_DEVICE</code></li>
<li class=""><code>CONFIG_VFIO_PCI</code></li>
</ul>
</li>
</ol>
<p><a href="https://releases.ubuntu.com/questing/" target="_blank" rel="noopener noreferrer" class="">Ubuntu Server 25.10</a>, for example, fulfills these requirements out-of-the-box, and no further changes are necessary here.</p>
<p>If the per-node requirements are fulfilled, deploy the <a href="https://docs.nvidia.com/datacenter/cloud-native/gpu-operator/latest" target="_blank" rel="noopener noreferrer" class="">NVIDIA GPU Operator</a> to the cluster. It provisions pod-VMs with GPUs via VFIO.</p>
<p>For a GPU-enabled Contrast cluster, you can then deploy the operator with the following commands:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Add the NVIDIA Helm repository</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> nvidia https://helm.ngc.nvidia.com/nvidia </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> helm repo update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Install the GPU Operator</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--wait</span><span class="token plain"> --generate-name </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> gpu-operator --create-namespace </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nvidia/gpu-operator </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--version</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">v25.10.1 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">sandboxWorkloads.enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">sandboxWorkloads.defaultWorkload</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">vm-passthrough </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">kataManager.enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">kataManager.config.runtimeClasses</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">null </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">kataManager.repository</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nvcr.io/nvidia/cloud-native </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">kataManager.image</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">k8s-kata-manager </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">kataManager.version</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">v0.2.4 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ccManager.enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ccManager.defaultMode</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">on </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ccManager.repository</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nvcr.io/nvidia/cloud-native </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ccManager.image</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">k8s-cc-manager </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ccManager.version</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">v0.2.0 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">sandboxDevicePlugin.repository</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ghcr.io/nvidia </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">sandboxDevicePlugin.image</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nvidia-sandbox-device-plugin </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">sandboxDevicePlugin.version</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">8e76fe81 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;sandboxDevicePlugin.env[0].name=P_GPU_ALIAS&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;sandboxDevicePlugin.env[0].value=pgpu&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">nfd.enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">nfd.nodefeaturerules</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true</span><br></span></code></pre></div></div>
<p>Refer to the <a href="https://docs.nvidia.com/datacenter/cloud-native/gpu-operator/latest/getting-started.html" target="_blank" rel="noopener noreferrer" class="">official installation instructions</a> for details and further options.</p>
<p>To enable support for Blackwell GPUs, some additional steps are necessary. For Hopper GPUs (for example the <code>NVIDIA H100 PCIe</code>), these steps can be skipped.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Enabling Support for Blackwell GPUs</summary><div><div class="collapsibleContent_i85q"><p>First, gather the Blackwell device ID:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lspci </span><span class="token parameter variable" style="color:#36acaa">-nnk</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;3D controller&#x27;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-A3</span><br></span></code></pre></div></div><p>Which yields output like this:</p><div class="language-shell-session codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell-session codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token output">0000:18:00.0 3D controller [0302]: NVIDIA Corporation GB100 [B200] [10de:2901] (rev a1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token output">        Subsystem: NVIDIA Corporation Device [10de:1999]</span><br></span><span class="token-line" style="color:#393A34"><span class="token output">        Kernel driver in use: vfio-pci</span><br></span><span class="token-line" style="color:#393A34"><span class="token output">        Kernel modules: nvidiafb, nouveau</span><br></span></code></pre></div></div><p>In this case, the device ID is <code>2901</code>. The device ID then needs to be added to the list of supported GPUs:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">device_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2901&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># replace with your device ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">current_ids</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">kubectl get daemonset nvidia-cc-manager </span><span class="token variable parameter variable" style="color:#36acaa">-n</span><span class="token variable" style="color:#36acaa"> gpu-operator </span><span class="token variable parameter variable" style="color:#36acaa">-o</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable assign-left variable" style="color:#36acaa">jsonpath</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable string" style="color:#e3116c">&#x27;{.spec.template.spec.containers[?(@.name==&quot;nvidia-cc-manager&quot;)].env[?(@.name==&quot;CC_CAPABLE_DEVICE_IDS&quot;)].value}&#x27;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">env</span><span class="token plain"> daemonset/nvidia-cc-manager </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> gpu-operator </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> nvidia-cc-manager </span><span class="token assign-left variable" style="color:#36acaa">CC_CAPABLE_DEVICE_IDS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${current_ids}</span><span class="token string" style="color:#e3116c">,0x</span><span class="token string variable" style="color:#36acaa">${device_id}</span><span class="token string" style="color:#e3116c">&quot;</span><br></span></code></pre></div></div><p>Then, the node feature rules need to be patched, so that the nodes with Blackwell GPUs are correctly recognized as nodes that can host GPU workloads.
For the B200 GPU shown above, the following values should be used:</p><ul>
<li class=""><code>GPU_NAME</code>: <code>NVIDIA B200</code></li>
<li class=""><code>GPU_NAME_SHORT</code>: <code>B200</code></li>
<li class=""><code>DEVICE_ID</code>: <code>2901</code></li>
</ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl patch nodefeaturerule nvidia-nfd-nodefeaturerules </span><span class="token parameter variable" style="color:#36acaa">--type</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;json&#x27;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;[</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;op&quot;: &quot;add&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;path&quot;: &quot;/spec/rules/10&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;value&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      &quot;name&quot;: &quot;&lt;GPU_NAME&gt;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      &quot;labels&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;nvidia.com/gpu.&lt;GPU_NAME_SHORT&gt;&quot;: &quot;true&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;nvidia.com/gpu.family&quot;: &quot;blackwell&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      &quot;matchFeatures&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          &quot;feature&quot;: &quot;pci.device&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          &quot;matchExpressions&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;device&quot;: {&quot;op&quot;: &quot;In&quot;, &quot;value&quot;: [&quot;&lt;DEVICE_ID&gt;&quot;]},</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;vendor&quot;: {&quot;op&quot;: &quot;In&quot;, &quot;value&quot;: [&quot;10de&quot;]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;op&quot;: &quot;add&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;path&quot;: &quot;/spec/rules/11/matchAny/0/matchFeatures/0/matchExpressions/nvidia.com~1gpu.family/value/-&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;value&quot;: &quot;blackwell&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;op&quot;: &quot;add&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;path&quot;: &quot;/spec/rules/11/matchAny/1/matchFeatures/0/matchExpressions/nvidia.com~1gpu.family/value/-&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;value&quot;: &quot;blackwell&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">]&#x27;</span><br></span></code></pre></div></div></div></div></details>
<p>Once the operator is fully deployed, which can take a few minutes, check the available GPUs in the cluster:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes </span><span class="token parameter variable" style="color:#36acaa">-l</span><span class="token plain"> nvidia.com/gpu.present </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> json </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  jq </span><span class="token string" style="color:#e3116c">&#x27;.items[0].status.allocatable |</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    with_entries(select(.key | startswith(&quot;nvidia.com/&quot;))) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    with_entries(select(.value != &quot;0&quot;))&#x27;</span><br></span></code></pre></div></div>
<p>The above command should yield an output similar to the following, depending on what GPUs are available:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;nvidia.com/pgpu&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>These identifiers are then used to <a class="" href="/contrast/next/howto/workload-deployment/GPU-configuration">run GPU workloads on the cluster</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/edgelesssys/contrast/edit/main/docs/docs/howto/cluster-setup/bare-metal.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/contrast/next/getting-started/deployment"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Workload deployment</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/contrast/next/howto/install-cli"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Install CLI</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#hardware-and-firmware-setup" class="table-of-contents__link toc-highlight">Hardware and firmware setup</a></li><li><a href="#kernel-setup" class="table-of-contents__link toc-highlight">Kernel setup</a></li><li><a href="#kubernetes-cluster-setup" class="table-of-contents__link toc-highlight">Kubernetes cluster setup</a><ul><li><a href="#k3s" class="table-of-contents__link toc-highlight">K3s</a></li></ul></li><li><a href="#preparing-a-cluster-for-gpu-usage" class="table-of-contents__link toc-highlight">Preparing a cluster for GPU usage</a><ul><li><a href="#supported-gpu-hardware" class="table-of-contents__link toc-highlight">Supported GPU hardware</a></li><li><a href="#setup" class="table-of-contents__link toc-highlight">Setup</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.edgeless.systems/#footer-id" target="_blank" rel="noopener noreferrer" class="footer__link-item">Newsletter<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.edgeless.systems/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://twitter.com/EdgelessSystems" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/edgeless-systems/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCOOInN0sCv6icUesisYIDeA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.edgeless.systems/imprint/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Imprint<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.edgeless.systems/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="javascript: Cookiebot.renew()" class="footer__link-item">Cookie Settings</a></li><li class="footer__item"><a href="https://www.edgeless.systems/contact-us/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact Us<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Edgeless Systems</div></div></div></footer></div>
</body>
</html>