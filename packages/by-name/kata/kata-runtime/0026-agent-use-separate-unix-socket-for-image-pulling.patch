From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Charlotte Hartmann Paludo <git@charlotteharludo.com>
Date: Mon, 11 Aug 2025 14:35:13 +0200
Subject: [PATCH] agent: use separate unix socket for image pulling

Signed-off-by: Charlotte Hartmann Paludo <git@charlotteharludo.com>
---
 src/agent/src/confidential_data_hub/mod.rs | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/agent/src/confidential_data_hub/mod.rs b/src/agent/src/confidential_data_hub/mod.rs
index b47edf7a641420fa6bbcb4ca10e47463cb9ec730..9bb1074dd422e52388200209c92f7937698606c8 100644
--- a/src/agent/src/confidential_data_hub/mod.rs
+++ b/src/agent/src/confidential_data_hub/mod.rs
@@ -192,7 +192,9 @@ pub async fn pull_image(image: &str, bundle_path: PathBuf) -> Result<String> {
 }
 
 pub async fn pull_image_contrast(image: &str, bundle_path: &str) -> Result<()> {
-    let client = ttrpc::asynchronous::Client::connect(CDH_SOCKET_URI)?;
+    let client = ttrpc::asynchronous::Client::connect(
+        "unix:///run/confidential-containers/imagepuller.sock",
+    )?;
     let image_pull_client =
         confidential_data_hub_ttrpc_async::ImagePullServiceClient::new(client.clone());
     let req = confidential_data_hub::ImagePullRequest {
